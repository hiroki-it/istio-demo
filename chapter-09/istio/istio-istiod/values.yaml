affinity:
  nodeAffinity:
    requiredDuringSchedulingIgnoredDuringExecution:
      nodeSelectorTerms:
        - matchExpressions:
            - key: node.kubernetes.io/nodegroup
              operator: In
              values:
                - system

autoscaleMin: 2

global:
  tag: 1.24.2
  imagePullPolicy: IfNotPresent
  defaultPodDisruptionBudget:
    minAvailable: 1
  defaultResources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 100m
      memory: 128Mi
  proxy:
    resources:
      requests:
        cpu: 100m
        memory: 128Mi
      limits:
        cpu: 100m
        memory: 128Mi
  variant: distroless

meshConfig:
  defaultConfig:
    holdApplicationUntilProxyStarts: true
  enableTracing: true
  defaultProviders:
    metrics:
      - prometheus
    tracing:
      - opentelemetry-grpc
  extensionProviders:
    - name: opentelemetry-grpc
      opentelemetry:
        service: opentelemetry-collector.agent.svc.cluster.local
        port: 4317
    - name: envoy-grpc
      envoyFileAccessLog:
        logFormat:
          # @see https://www.envoyproxy.io/docs/envoy/latest/configuration/observability/access_log/usage#format-rules
          labels:
            access_log_type: '%ACCESS_LOG_TYPE%'
            bytes_received: '%BYTES_RECEIVED%'
            bytes_sent: '%BYTES_SENT%'
            downstream_transport_failure_reason: '%DOWNSTREAM_TRANSPORT_FAILURE_REASON%'
            downstream_remote_port: '%DOWNSTREAM_REMOTE_PORT%'
            duration: '%DURATION%'
            grpc_status: '%GRPC_STATUS(CAMEL_STRING)%'
            method: '%REQ(:METHOD)%'
            path: '%REQ(X-ENVOY-ORIGINAL-PATH?:PATH)%'
            protocol: '%PROTOCOL%'
            response_code: '%RESPONSE_CODE%'
            response_flags: '%RESPONSE_FLAGS%'
            start_time: '%START_TIME%'
            trace_id: '%TRACE_ID%'
            traceparent: '%REQ(TRACEPARENT)%'
            upstream_remote_port: '%UPSTREAM_REMOTE_PORT%'
            upstream_transport_failure_reason: '%UPSTREAM_TRANSPORT_FAILURE_REASON%'
            user_agent: '%REQ(USER-AGENT)%'
            x_forwarded_for: '%REQ(X-FORWARDED-FOR)%'
  rootNamespace: null
  discoverySelectors:
    - matchLabels:
        istio.io/rev: stable

revision: 1-24-2

revisionTags:
  - stable
