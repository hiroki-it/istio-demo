grafana.ini:
  auth.anonymous:
    enabled: true
    org_role: Admin
  date_formats:
    default_timezone: Asia/Tokyo
  users:
    default_theme: light

service:
  type: NodePort
  nodePort: 32003

datasources:
  datasources.yaml:
    apiVersion: 1
    datasources:
      - name: Prometheus
        type: prometheus
        url: http://prometheus-server.prometheus.svc.cluster.local:9090
        isDefault: true

dashboards:
  local:
    kubernetes-deployment-hardware-resources:
      json: '{ "annotations": { "list": [ { "builtIn": 1, "datasource": { "type": "grafana", "uid": "-- Grafana --" }, "enable": true, "hide": true, "iconColor": "rgba(0, 211, 255, 1)", "name": "Annotations & Alerts", "type": "dashboard" } ] }, "description": "Kubernetes DeploymentのCPUやメモリを可視化する", "editable": true, "fiscalYearStartMonth": 0, "graphTooltip": 0, "id": 9, "links": [], "panels": [ { "datasource": { "uid": "$datasource" }, "fieldConfig": { "defaults": { "decimals": 2, "mappings": [ { "options": { "match": "null", "result": { "text": "N/A" } }, "type": "special" } ], "max": 100, "min": 0, "thresholds": { "mode": "absolute", "steps": [ { "color": "rgba(50, 172, 45, 0.97)", "value": null }, { "color": "rgba(237, 129, 40, 0.89)", "value": 65 }, { "color": "rgba(245, 54, 54, 0.9)", "value": 90 } ] }, "unit": "percent" }, "overrides": [] }, "gridPos": { "h": 5, "w": 8, "x": 0, "y": 0 }, "id": 6, "maxDataPoints": 100, "options": { "colorMode": "value", "graphMode": "none", "justifyMode": "auto", "orientation": "horizontal", "percentChangeColorMode": "standard", "reduceOptions": { "calcs": [ "lastNotNull" ], "fields": "", "values": false }, "showPercentChange": false, "textMode": "auto", "wideLayout": true }, "pluginVersion": "11.5.2", "targets": [ { "datasource": { "uid": "$datasource" }, "expr": "sum (rate (container_cpu_usage_seconds_total{pod=~\"^$Deployment.*$\"}[1m])) / sum (machine_cpu_cores{kubernetes_io_hostname=~\"^$Node$\"}) * 100", "interval": "10s", "intervalFactor": 1, "refId": "A", "step": 10 } ], "title": "CPU使用率 (Pod / Node)", "type": "stat" }, { "datasource": { "uid": "$datasource" }, "fieldConfig": { "defaults": { "mappings": [ { "options": { "match": "null", "result": { "text": "N/A" } }, "type": "special" } ], "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": null }, { "color": "red", "value": 80 } ] }, "unit": "none" }, "overrides": [] }, "gridPos": { "h": 5, "w": 8, "x": 8, "y": 0 }, "id": 40, "maxDataPoints": 100, "options": { "colorMode": "none", "graphMode": "none", "justifyMode": "auto", "orientation": "horizontal", "percentChangeColorMode": "standard", "reduceOptions": { "calcs": [ "mean" ], "fields": "", "values": false }, "showPercentChange": false, "textMode": "auto", "wideLayout": true }, "pluginVersion": "11.5.2", "targets": [ { "datasource": { "uid": "$datasource" }, "expr": "sum (rate (container_cpu_usage_seconds_total{pod=~\"^$Deployment.*$\"}[1m]))", "intervalFactor": 2, "refId": "A", "step": 40 } ], "title": "CPU使用量 (Pod単位)", "type": "stat" }, { "datasource": { "uid": "$datasource" }, "fieldConfig": { "defaults": { "mappings": [ { "options": { "match": "null", "result": { "text": "N/A" } }, "type": "special" } ], "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": null }, { "color": "red", "value": 80 } ] }, "unit": "none" }, "overrides": [] }, "gridPos": { "h": 5, "w": 8, "x": 16, "y": 0 }, "id": 41, "maxDataPoints": 100, "options": { "colorMode": "none", "graphMode": "none", "justifyMode": "auto", "orientation": "horizontal", "percentChangeColorMode": "standard", "reduceOptions": { "calcs": [ "mean" ], "fields": "", "values": false }, "showPercentChange": false, "textMode": "auto", "wideLayout": true }, "pluginVersion": "11.5.2", "targets": [ { "datasource": { "uid": "$datasource" }, "expr": "sum (machine_cpu_cores{kubernetes_io_hostname=~\"^$Node$\"})", "intervalFactor": 2, "refId": "A", "step": 40 } ], "title": "合計CPU使用量 (Node単位)", "type": "stat" }, { "datasource": { "uid": "$datasource" }, "fieldConfig": { "defaults": { "color": { "mode": "palette-classic" }, "custom": { "axisBorderShow": false, "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "cores", "axisPlacement": "auto", "barAlignment": 0, "barWidthFactor": 0.6, "drawStyle": "line", "fillOpacity": 0, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "insertNulls": false, "lineInterpolation": "linear", "lineWidth": 2, "pointSize": 5, "scaleDistribution": { "type": "linear" }, "showPoints": "never", "spanNulls": true, "stacking": { "group": "A", "mode": "none" }, "thresholdsStyle": { "mode": "off" } }, "mappings": [], "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": null }, { "color": "red", "value": 80 } ] }, "unit": "none" }, "overrides": [] }, "gridPos": { "h": 7, "w": 24, "x": 0, "y": 5 }, "id": 17, "options": { "legend": { "calcs": [ "mean", "lastNotNull" ], "displayMode": "table", "placement": "right", "showLegend": true }, "tooltip": { "hideZeros": false, "mode": "multi", "sort": "desc" } }, "pluginVersion": "11.5.2", "targets": [ { "datasource": { "uid": "$datasource" }, "expr": "sum (rate (container_cpu_usage_seconds_total{image!=\"\",pod=~\"^$Deployment.*$\"}[1m])) by (pod)", "interval": "10s", "intervalFactor": 1, "legendFormat": "pod: {{ pod }}", "metric": "container_cpu", "refId": "A", "step": 10 } ], "title": "CPU使用率 (Pod単位)", "type": "timeseries" }, { "datasource": { "uid": "$datasource" }, "fieldConfig": { "defaults": { "color": { "mode": "palette-classic" }, "custom": { "axisBorderShow": false, "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "cores", "axisPlacement": "auto", "barAlignment": 0, "barWidthFactor": 0.6, "drawStyle": "line", "fillOpacity": 0, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "insertNulls": false, "lineInterpolation": "linear", "lineWidth": 2, "pointSize": 5, "scaleDistribution": { "type": "linear" }, "showPoints": "never", "spanNulls": true, "stacking": { "group": "A", "mode": "none" }, "thresholdsStyle": { "mode": "off" } }, "mappings": [], "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": null }, { "color": "red", "value": 80 } ] }, "unit": "none" }, "overrides": [ { "__systemRef": "hideSeriesFrom", "matcher": { "id": "byNames", "options": { "mode": "exclude", "names": [ "container: " ], "prefix": "All except:", "readOnly": true } }, "properties": [ { "id": "custom.hideFrom", "value": { "legend": false, "tooltip": false, "viz": true } } ] } ] }, "gridPos": { "h": 7, "w": 24, "x": 0, "y": 12 }, "id": 24, "options": { "legend": { "calcs": [ "mean", "lastNotNull" ], "displayMode": "table", "placement": "right", "showLegend": true }, "tooltip": { "hideZeros": false, "mode": "multi", "sort": "desc" } }, "pluginVersion": "11.5.2", "targets": [ { "datasource": { "uid": "$datasource" }, "editorMode": "code", "expr": "sum (rate (container_cpu_usage_seconds_total{image!=\"\",container!=\"\",pod=~\"^$Deployment.*$\"}[1m])) by (container, pod)", "hide": false, "interval": "10s", "intervalFactor": 1, "legendFormat": "container: {{ container }}", "metric": "container_cpu", "range": true, "refId": "A", "step": 10 } ], "title": "CPU使用率 (コンテナ単位)", "type": "timeseries" }, { "datasource": { "uid": "$datasource" }, "fieldConfig": { "defaults": { "mappings": [ { "options": { "match": "null", "result": { "text": "N/A" } }, "type": "special" } ], "max": 100, "min": 0, "thresholds": { "mode": "absolute", "steps": [ { "color": "rgba(50, 172, 45, 0.97)", "value": null }, { "color": "rgba(237, 129, 40, 0.89)", "value": 65 }, { "color": "rgba(245, 54, 54, 0.9)", "value": 90 } ] }, "unit": "percent" }, "overrides": [] }, "gridPos": { "h": 5, "w": 8, "x": 0, "y": 19 }, "id": 4, "maxDataPoints": 100, "options": { "colorMode": "value", "graphMode": "none", "justifyMode": "auto", "orientation": "horizontal", "percentChangeColorMode": "standard", "reduceOptions": { "calcs": [ "lastNotNull" ], "fields": "", "values": false }, "showPercentChange": false, "textMode": "auto", "wideLayout": true }, "pluginVersion": "11.5.2", "targets": [ { "datasource": { "uid": "$datasource" }, "expr": "sum (container_memory_working_set_bytes{pod=~\"^$Deployment.*$\"}) / sum (machine_memory_bytes{kubernetes_io_hostname=~\"^$Node$\"}) * 100", "interval": "10s", "intervalFactor": 1, "refId": "A", "step": 10 } ], "title": "メモリ使用率 (Pod / Node)", "type": "stat" }, { "datasource": { "uid": "$datasource" }, "fieldConfig": { "defaults": { "mappings": [ { "options": { "match": "null", "result": { "text": "N/A" } }, "type": "special" } ], "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": null }, { "color": "red", "value": 80 } ] }, "unit": "bytes" }, "overrides": [] }, "gridPos": { "h": 5, "w": 8, "x": 8, "y": 19 }, "id": 38, "maxDataPoints": 100, "options": { "colorMode": "none", "graphMode": "none", "justifyMode": "auto", "orientation": "horizontal", "percentChangeColorMode": "standard", "reduceOptions": { "calcs": [ "mean" ], "fields": "", "values": false }, "showPercentChange": false, "textMode": "auto", "wideLayout": true }, "pluginVersion": "11.5.2", "targets": [ { "datasource": { "uid": "$datasource" }, "expr": "sum (container_memory_working_set_bytes{pod=~\"^$Deployment.*$\"})", "intervalFactor": 2, "refId": "A", "step": 40 } ], "title": "メモリ使用量 (Pod単位)", "type": "stat" }, { "datasource": { "uid": "$datasource" }, "fieldConfig": { "defaults": { "mappings": [ { "options": { "match": "null", "result": { "text": "N/A" } }, "type": "special" } ], "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": null }, { "color": "red", "value": 80 } ] }, "unit": "bytes" }, "overrides": [] }, "gridPos": { "h": 5, "w": 8, "x": 16, "y": 19 }, "id": 39, "maxDataPoints": 100, "options": { "colorMode": "none", "graphMode": "none", "justifyMode": "auto", "orientation": "horizontal", "percentChangeColorMode": "standard", "reduceOptions": { "calcs": [ "mean" ], "fields": "", "values": false }, "showPercentChange": false, "textMode": "auto", "wideLayout": true }, "pluginVersion": "11.5.2", "targets": [ { "datasource": { "uid": "$datasource" }, "expr": "sum (machine_memory_bytes{kubernetes_io_hostname=~\"^$Node.*$\"})", "intervalFactor": 2, "refId": "A", "step": 40 } ], "title": "合計メモリ使用量 (Node単位)", "type": "stat" }, { "datasource": { "uid": "$datasource" }, "fieldConfig": { "defaults": { "color": { "mode": "palette-classic" }, "custom": { "axisBorderShow": false, "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "barWidthFactor": 0.6, "drawStyle": "line", "fillOpacity": 0, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "insertNulls": false, "lineInterpolation": "linear", "lineWidth": 2, "pointSize": 5, "scaleDistribution": { "type": "linear" }, "showPoints": "never", "spanNulls": true, "stacking": { "group": "A", "mode": "none" }, "thresholdsStyle": { "mode": "off" } }, "mappings": [], "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": null }, { "color": "red", "value": 80 } ] }, "unit": "bytes" }, "overrides": [] }, "gridPos": { "h": 7, "w": 24, "x": 0, "y": 24 }, "id": 25, "options": { "legend": { "calcs": [ "mean", "lastNotNull" ], "displayMode": "table", "placement": "right", "showLegend": true, "width": 200 }, "tooltip": { "hideZeros": false, "mode": "multi", "sort": "desc" } }, "pluginVersion": "11.5.2", "targets": [ { "datasource": { "uid": "$datasource" }, "expr": "sum (container_memory_working_set_bytes{image!=\"\",pod=~\"^$Deployment.*$\"}) by (pod)", "interval": "10s", "intervalFactor": 1, "legendFormat": "pod: {{ pod }}", "metric": "container_memory_usage:sort_desc", "refId": "A", "step": 10 } ], "title": "メモリ使用率 (Pod単位)", "type": "timeseries" }, { "datasource": { "uid": "$datasource" }, "fieldConfig": { "defaults": { "color": { "mode": "palette-classic" }, "custom": { "axisBorderShow": false, "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "barWidthFactor": 0.6, "drawStyle": "line", "fillOpacity": 0, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "insertNulls": false, "lineInterpolation": "linear", "lineWidth": 2, "pointSize": 5, "scaleDistribution": { "type": "linear" }, "showPoints": "never", "spanNulls": true, "stacking": { "group": "A", "mode": "none" }, "thresholdsStyle": { "mode": "off" } }, "mappings": [], "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": null }, { "color": "red", "value": 80 } ] }, "unit": "bytes" }, "overrides": [] }, "gridPos": { "h": 7, "w": 24, "x": 0, "y": 31 }, "id": 44, "options": { "legend": { "calcs": [ "mean", "lastNotNull" ], "displayMode": "table", "placement": "right", "showLegend": true, "sortBy": "Name", "sortDesc": true, "width": 200 }, "tooltip": { "hideZeros": false, "mode": "multi", "sort": "desc" } }, "pluginVersion": "11.5.2", "targets": [ { "datasource": { "uid": "$datasource" }, "editorMode": "code", "expr": "sum (container_memory_working_set_bytes{image!=\"\",container!=\"POD\",pod=~\"^$Deployment.*$\"}) by (container)", "interval": "10s", "intervalFactor": 1, "legendFormat": "container: {{ container }}", "metric": "container_memory_usage:sort_desc", "range": true, "refId": "A", "step": 10 } ], "title": "メモリ使用率 (コンテナ単位)", "type": "timeseries" } ], "preload": false, "refresh": "10s", "schemaVersion": 40, "tags": [ "kubernetes" ], "templating": { "list": [ { "current": { "text": "default", "value": "default" }, "label": "Data Source", "name": "datasource", "options": [], "query": "prometheus", "refresh": 1, "regex": "", "type": "datasource" }, { "allValue": ".*", "current": {}, "datasource": "$datasource", "includeAll": false, "name": "Deployment", "options": [], "query": "label_values(deployment)", "refresh": 1, "type": "query" }, { "allValue": ".*", "current": {}, "datasource": "$datasource", "includeAll": true, "name": "Node", "options": [], "query": "label_values(kubernetes_io_hostname)", "refresh": 1, "type": "query" } ] }, "time": { "from": "now-30m", "to": "now" }, "timepicker": {}, "timezone": "browser", "title": "Kubernetes Deployment (CPU、メモリ)", "version": 1, "weekStart": "" }'
    kubernetes-statefulset-hardware-resources:
      json: '{ "annotations": { "list": [ { "builtIn": 1, "datasource": { "type": "grafana", "uid": "-- Grafana --" }, "enable": true, "hide": true, "iconColor": "rgba(0, 211, 255, 1)", "name": "Annotations & Alerts", "type": "dashboard" } ] }, "description": "Kubernetes StatefulSetのCPUやメモリを可視化する", "editable": true, "fiscalYearStartMonth": 0, "graphTooltip": 0, "id": 6, "links": [], "panels": [ { "datasource": { "uid": "$datasource" }, "fieldConfig": { "defaults": { "decimals": 2, "mappings": [ { "options": { "match": "null", "result": { "text": "N/A" } }, "type": "special" } ], "max": 100, "min": 0, "thresholds": { "mode": "absolute", "steps": [ { "color": "rgba(50, 172, 45, 0.97)", "value": null }, { "color": "rgba(237, 129, 40, 0.89)", "value": 65 }, { "color": "rgba(245, 54, 54, 0.9)", "value": 90 } ] }, "unit": "percent" }, "overrides": [] }, "gridPos": { "h": 5, "w": 8, "x": 0, "y": 0 }, "id": 6, "maxDataPoints": 100, "options": { "colorMode": "value", "graphMode": "none", "justifyMode": "auto", "orientation": "horizontal", "percentChangeColorMode": "standard", "reduceOptions": { "calcs": [ "lastNotNull" ], "fields": "", "values": false }, "showPercentChange": false, "textMode": "auto", "wideLayout": true }, "pluginVersion": "11.5.2", "targets": [ { "datasource": { "uid": "$datasource" }, "expr": "sum (rate (container_cpu_usage_seconds_total{pod=~\"^$StatefulSet.*$\"}[1m])) / sum (machine_cpu_cores{kubernetes_io_hostname=~\"^$Node$\"}) * 100", "interval": "10s", "intervalFactor": 1, "refId": "A", "step": 10 } ], "title": "CPU使用率 (Pod / Node)", "type": "stat" }, { "datasource": { "uid": "$datasource" }, "fieldConfig": { "defaults": { "mappings": [ { "options": { "match": "null", "result": { "text": "N/A" } }, "type": "special" } ], "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": null }, { "color": "red", "value": 80 } ] }, "unit": "none" }, "overrides": [] }, "gridPos": { "h": 5, "w": 8, "x": 8, "y": 0 }, "id": 40, "maxDataPoints": 100, "options": { "colorMode": "none", "graphMode": "none", "justifyMode": "auto", "orientation": "horizontal", "percentChangeColorMode": "standard", "reduceOptions": { "calcs": [ "mean" ], "fields": "", "values": false }, "showPercentChange": false, "textMode": "auto", "wideLayout": true }, "pluginVersion": "11.5.2", "targets": [ { "datasource": { "uid": "$datasource" }, "expr": "sum (rate (container_cpu_usage_seconds_total{pod=~\"^$StatefulSet.*$\"}[1m]))", "intervalFactor": 2, "refId": "A", "step": 40 } ], "title": "CPU使用量 (Pod単位)", "type": "stat" }, { "datasource": { "uid": "$datasource" }, "fieldConfig": { "defaults": { "mappings": [ { "options": { "match": "null", "result": { "text": "N/A" } }, "type": "special" } ], "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": null }, { "color": "red", "value": 80 } ] }, "unit": "none" }, "overrides": [] }, "gridPos": { "h": 5, "w": 8, "x": 16, "y": 0 }, "id": 41, "maxDataPoints": 100, "options": { "colorMode": "none", "graphMode": "none", "justifyMode": "auto", "orientation": "horizontal", "percentChangeColorMode": "standard", "reduceOptions": { "calcs": [ "mean" ], "fields": "", "values": false }, "showPercentChange": false, "textMode": "auto", "wideLayout": true }, "pluginVersion": "11.5.2", "targets": [ { "datasource": { "uid": "$datasource" }, "expr": "sum (machine_cpu_cores{kubernetes_io_hostname=~\"^$Node$\"})", "intervalFactor": 2, "refId": "A", "step": 40 } ], "title": "合計CPU使用量 (Node単位)", "type": "stat" }, { "datasource": { "uid": "$datasource" }, "fieldConfig": { "defaults": { "color": { "mode": "palette-classic" }, "custom": { "axisBorderShow": false, "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "cores", "axisPlacement": "auto", "barAlignment": 0, "barWidthFactor": 0.6, "drawStyle": "line", "fillOpacity": 0, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "insertNulls": false, "lineInterpolation": "linear", "lineWidth": 2, "pointSize": 5, "scaleDistribution": { "type": "linear" }, "showPoints": "never", "spanNulls": true, "stacking": { "group": "A", "mode": "none" }, "thresholdsStyle": { "mode": "off" } }, "mappings": [], "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": null }, { "color": "red", "value": 80 } ] }, "unit": "none" }, "overrides": [] }, "gridPos": { "h": 7, "w": 24, "x": 0, "y": 5 }, "id": 17, "options": { "legend": { "calcs": [ "mean", "lastNotNull" ], "displayMode": "table", "placement": "right", "showLegend": true }, "tooltip": { "hideZeros": false, "mode": "multi", "sort": "desc" } }, "pluginVersion": "11.5.2", "targets": [ { "datasource": { "uid": "$datasource" }, "expr": "sum (rate (container_cpu_usage_seconds_total{image!=\"\",pod=~\"^$StatefulSet.*$\"}[1m])) by (pod)", "interval": "10s", "intervalFactor": 1, "legendFormat": "pod: {{ pod }}", "metric": "container_cpu", "refId": "A", "step": 10 } ], "title": "CPU使用率 (Pod単位)", "type": "timeseries" }, { "datasource": { "uid": "$datasource" }, "fieldConfig": { "defaults": { "color": { "mode": "palette-classic" }, "custom": { "axisBorderShow": false, "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "cores", "axisPlacement": "auto", "barAlignment": 0, "barWidthFactor": 0.6, "drawStyle": "line", "fillOpacity": 0, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "insertNulls": false, "lineInterpolation": "linear", "lineWidth": 2, "pointSize": 5, "scaleDistribution": { "type": "linear" }, "showPoints": "never", "spanNulls": true, "stacking": { "group": "A", "mode": "none" }, "thresholdsStyle": { "mode": "off" } }, "mappings": [], "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": null }, { "color": "red", "value": 80 } ] }, "unit": "none" }, "overrides": [ { "__systemRef": "hideSeriesFrom", "matcher": { "id": "byNames", "options": { "mode": "exclude", "names": [ "container: " ], "prefix": "All except:", "readOnly": true } }, "properties": [ { "id": "custom.hideFrom", "value": { "legend": false, "tooltip": false, "viz": true } } ] } ] }, "gridPos": { "h": 7, "w": 24, "x": 0, "y": 12 }, "id": 24, "options": { "legend": { "calcs": [ "mean", "lastNotNull" ], "displayMode": "table", "placement": "right", "showLegend": true }, "tooltip": { "hideZeros": false, "mode": "multi", "sort": "desc" } }, "pluginVersion": "11.5.2", "targets": [ { "datasource": { "uid": "$datasource" }, "editorMode": "code", "expr": "sum (rate (container_cpu_usage_seconds_total{image!=\"\",container!=\"\",pod=~\"^$StatefulSet.*$\"}[1m])) by (container, pod)", "hide": false, "interval": "10s", "intervalFactor": 1, "legendFormat": "container: {{ container }}", "metric": "container_cpu", "range": true, "refId": "A", "step": 10 } ], "title": "CPU使用率 (コンテナ単位)", "type": "timeseries" }, { "datasource": { "uid": "$datasource" }, "fieldConfig": { "defaults": { "mappings": [ { "options": { "match": "null", "result": { "text": "N/A" } }, "type": "special" } ], "max": 100, "min": 0, "thresholds": { "mode": "absolute", "steps": [ { "color": "rgba(50, 172, 45, 0.97)", "value": null }, { "color": "rgba(237, 129, 40, 0.89)", "value": 65 }, { "color": "rgba(245, 54, 54, 0.9)", "value": 90 } ] }, "unit": "percent" }, "overrides": [] }, "gridPos": { "h": 5, "w": 8, "x": 0, "y": 19 }, "id": 4, "maxDataPoints": 100, "options": { "colorMode": "value", "graphMode": "none", "justifyMode": "auto", "orientation": "horizontal", "percentChangeColorMode": "standard", "reduceOptions": { "calcs": [ "lastNotNull" ], "fields": "", "values": false }, "showPercentChange": false, "textMode": "auto", "wideLayout": true }, "pluginVersion": "11.5.2", "targets": [ { "datasource": { "uid": "$datasource" }, "expr": "sum (container_memory_working_set_bytes{pod=~\"^$StatefulSet.*$\"}) / sum (machine_memory_bytes{kubernetes_io_hostname=~\"^$Node$\"}) * 100", "interval": "10s", "intervalFactor": 1, "refId": "A", "step": 10 } ], "title": "メモリ使用率 (Pod / Node)", "type": "stat" }, { "datasource": { "uid": "$datasource" }, "fieldConfig": { "defaults": { "mappings": [ { "options": { "match": "null", "result": { "text": "N/A" } }, "type": "special" } ], "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": null }, { "color": "red", "value": 80 } ] }, "unit": "bytes" }, "overrides": [] }, "gridPos": { "h": 5, "w": 8, "x": 8, "y": 19 }, "id": 38, "maxDataPoints": 100, "options": { "colorMode": "none", "graphMode": "none", "justifyMode": "auto", "orientation": "horizontal", "percentChangeColorMode": "standard", "reduceOptions": { "calcs": [ "mean" ], "fields": "", "values": false }, "showPercentChange": false, "textMode": "auto", "wideLayout": true }, "pluginVersion": "11.5.2", "targets": [ { "datasource": { "uid": "$datasource" }, "expr": "sum (container_memory_working_set_bytes{pod=~\"^$StatefulSet.*$\"})", "intervalFactor": 2, "refId": "A", "step": 40 } ], "title": "メモリ使用量 (Pod単位)", "type": "stat" }, { "datasource": { "uid": "$datasource" }, "fieldConfig": { "defaults": { "mappings": [ { "options": { "match": "null", "result": { "text": "N/A" } }, "type": "special" } ], "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": null }, { "color": "red", "value": 80 } ] }, "unit": "bytes" }, "overrides": [] }, "gridPos": { "h": 5, "w": 8, "x": 16, "y": 19 }, "id": 39, "maxDataPoints": 100, "options": { "colorMode": "none", "graphMode": "none", "justifyMode": "auto", "orientation": "horizontal", "percentChangeColorMode": "standard", "reduceOptions": { "calcs": [ "mean" ], "fields": "", "values": false }, "showPercentChange": false, "textMode": "auto", "wideLayout": true }, "pluginVersion": "11.5.2", "targets": [ { "datasource": { "uid": "$datasource" }, "expr": "sum (machine_memory_bytes{kubernetes_io_hostname=~\"^$Node.*$\"})", "intervalFactor": 2, "refId": "A", "step": 40 } ], "title": "合計メモリ使用量 (Node単位)", "type": "stat" }, { "datasource": { "uid": "$datasource" }, "fieldConfig": { "defaults": { "color": { "mode": "palette-classic" }, "custom": { "axisBorderShow": false, "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "barWidthFactor": 0.6, "drawStyle": "line", "fillOpacity": 0, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "insertNulls": false, "lineInterpolation": "linear", "lineWidth": 2, "pointSize": 5, "scaleDistribution": { "type": "linear" }, "showPoints": "never", "spanNulls": true, "stacking": { "group": "A", "mode": "none" }, "thresholdsStyle": { "mode": "off" } }, "mappings": [], "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": null }, { "color": "red", "value": 80 } ] }, "unit": "bytes" }, "overrides": [] }, "gridPos": { "h": 7, "w": 24, "x": 0, "y": 24 }, "id": 25, "options": { "legend": { "calcs": [ "mean", "lastNotNull" ], "displayMode": "table", "placement": "right", "showLegend": true, "width": 200 }, "tooltip": { "hideZeros": false, "mode": "multi", "sort": "desc" } }, "pluginVersion": "11.5.2", "targets": [ { "datasource": { "uid": "$datasource" }, "expr": "sum (container_memory_working_set_bytes{image!=\"\",pod=~\"^$StatefulSet.*$\"}) by (pod)", "interval": "10s", "intervalFactor": 1, "legendFormat": "pod: {{ pod }}", "metric": "container_memory_usage:sort_desc", "refId": "A", "step": 10 } ], "title": "メモリ使用率 (Pod単位)", "type": "timeseries" }, { "datasource": { "uid": "$datasource" }, "fieldConfig": { "defaults": { "color": { "mode": "palette-classic" }, "custom": { "axisBorderShow": false, "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "barWidthFactor": 0.6, "drawStyle": "line", "fillOpacity": 0, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "insertNulls": false, "lineInterpolation": "linear", "lineWidth": 2, "pointSize": 5, "scaleDistribution": { "type": "linear" }, "showPoints": "never", "spanNulls": true, "stacking": { "group": "A", "mode": "none" }, "thresholdsStyle": { "mode": "off" } }, "mappings": [], "thresholds": { "mode": "absolute", "steps": [ { "color": "green" }, { "color": "red", "value": 80 } ] }, "unit": "bytes" }, "overrides": [] }, "gridPos": { "h": 7, "w": 24, "x": 0, "y": 31 }, "id": 44, "options": { "legend": { "calcs": [ "mean", "lastNotNull" ], "displayMode": "table", "placement": "right", "showLegend": true, "sortBy": "Name", "sortDesc": true, "width": 200 }, "tooltip": { "hideZeros": false, "mode": "multi", "sort": "desc" } }, "pluginVersion": "11.5.2", "targets": [ { "datasource": { "uid": "$datasource" }, "editorMode": "code", "expr": "sum (container_memory_working_set_bytes{image!=\"\",container!=\"POD\",pod=~\"^$StatefulSet.*$\"}) by (container)", "interval": "10s", "intervalFactor": 1, "legendFormat": "container: {{ container }}", "metric": "container_memory_usage:sort_desc", "range": true, "refId": "A", "step": 10 } ], "title": "メモリ使用率 (コンテナ単位)", "type": "timeseries" } ], "preload": false, "refresh": "10s", "schemaVersion": 40, "tags": [ "kubernetes" ], "templating": { "list": [ { "current": { "text": "default", "value": "default" }, "label": "Data Source", "name": "datasource", "options": [], "query": "prometheus", "refresh": 1, "regex": "", "type": "datasource" }, { "allValue": ".*", "current": { "text": "coredns", "value": "coredns" }, "datasource": "$datasource", "includeAll": false, "name": "StatefulSet", "options": [], "query": "label_values(statefulset)", "refresh": 1, "type": "query" }, { "allValue": ".*", "current": { "text": "All", "value": "$__all" }, "datasource": "$datasource", "includeAll": true, "name": "Node", "options": [], "query": "label_values(kubernetes_io_hostname)", "refresh": 1, "type": "query" } ] }, "time": { "from": "now-30m", "to": "now" }, "timepicker": {}, "timezone": "browser", "title": "Kubernetes StatefulSet (CPU、メモリ)", "version": 1, "weekStart": "" }'
    istio-service-mesh-network:
      json: '{ "annotations": { "list": [ { "builtIn": 1, "datasource": { "type": "grafana", "uid": "-- Grafana --" }, "enable": true, "hide": true, "iconColor": "rgba(0, 211, 255, 1)", "name": "Annotations & Alerts", "type": "dashboard" } ] }, "description": "Istioサービスメッシュのネットワークを可視化する", "editable": true, "fiscalYearStartMonth": 0, "graphTooltip": 1, "id": 1, "links": [], "panels": [ { "datasource": { "type": "datasource", "uid": "-- Mixed --" }, "fieldConfig": { "defaults": { "color": { "fixedColor": "blue", "mode": "fixed" }, "mappings": [], "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": null }, { "color": "red", "value": 80 } ] }, "unit": "reqps" }, "overrides": [] }, "gridPos": { "h": 5, "w": 6, "x": 0, "y": 0 }, "id": 2, "interval": "5s", "options": { "colorMode": "value", "graphMode": "area", "justifyMode": "auto", "legend": { "calcs": [ "last", "max" ], "displayMode": "table" }, "orientation": "auto", "percentChangeColorMode": "standard", "reduceOptions": { "calcs": [ "lastNotNull" ], "fields": "", "values": false }, "showPercentChange": false, "textMode": "auto", "wideLayout": true }, "pluginVersion": "11.5.2", "targets": [ { "datasource": { "type": "prometheus", "uid": "$datasource" }, "expr": "round(sum (rate(istio_requests_total{reporter=~\"source|waypoint\"}[$__rate_interval])), 0.01)", "refId": "A" } ], "title": "合計リクエスト数", "type": "stat" }, { "datasource": { "type": "datasource", "uid": "-- Mixed --" }, "fieldConfig": { "defaults": { "color": { "fixedColor": "blue", "mode": "fixed" }, "mappings": [], "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": null }, { "color": "red", "value": 80 } ] }, "unit": "percentunit" }, "overrides": [] }, "gridPos": { "h": 5, "w": 6, "x": 6, "y": 0 }, "id": 3, "interval": "5s", "options": { "colorMode": "value", "graphMode": "area", "justifyMode": "auto", "legend": { "calcs": [ "last", "max" ], "displayMode": "table" }, "orientation": "auto", "percentChangeColorMode": "standard", "reduceOptions": { "calcs": [ "lastNotNull" ], "fields": "", "values": false }, "showPercentChange": false, "textMode": "auto", "wideLayout": true }, "pluginVersion": "11.5.2", "targets": [ { "datasource": { "type": "prometheus", "uid": "$datasource" }, "expr": "sum (rate(istio_requests_total{reporter=~\"source|waypoint\",response_code!~\"5..\"}[$__rate_interval])) / sum (rate(istio_requests_total{reporter=~\"source|waypoint\"}[$__rate_interval]))", "refId": "A" } ], "title": "リクエスト成功率", "type": "stat" }, { "datasource": { "type": "datasource", "uid": "-- Mixed --" }, "fieldConfig": { "defaults": { "color": { "fixedColor": "blue", "mode": "fixed" }, "mappings": [], "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": null }, { "color": "red", "value": 80 } ] }, "unit": "reqps" }, "overrides": [] }, "gridPos": { "h": 5, "w": 6, "x": 12, "y": 0 }, "id": 4, "interval": "5s", "options": { "colorMode": "value", "graphMode": "area", "justifyMode": "auto", "legend": { "calcs": [ "last", "max" ], "displayMode": "table" }, "orientation": "auto", "percentChangeColorMode": "standard", "reduceOptions": { "calcs": [ "lastNotNull" ], "fields": "", "values": false }, "showPercentChange": false, "textMode": "auto", "wideLayout": true }, "pluginVersion": "11.5.2", "targets": [ { "datasource": { "type": "prometheus", "uid": "$datasource" }, "expr": "round(sum (rate(istio_requests_total{reporter=~\"source|waypoint\",response_code=~\"4..\"}[$__rate_interval])), 0.01)or vector(0)", "refId": "A" } ], "title": "合計4xxステータス数", "type": "stat" }, { "datasource": { "type": "datasource", "uid": "-- Mixed --" }, "fieldConfig": { "defaults": { "color": { "fixedColor": "blue", "mode": "fixed" }, "mappings": [], "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": null }, { "color": "red", "value": 80 } ] }, "unit": "reqps" }, "overrides": [] }, "gridPos": { "h": 5, "w": 6, "x": 18, "y": 0 }, "id": 5, "interval": "5s", "options": { "colorMode": "value", "graphMode": "area", "justifyMode": "auto", "legend": { "calcs": [ "last", "max" ], "displayMode": "table" }, "orientation": "auto", "percentChangeColorMode": "standard", "reduceOptions": { "calcs": [ "lastNotNull" ], "fields": "", "values": false }, "showPercentChange": false, "textMode": "auto", "wideLayout": true }, "pluginVersion": "11.5.2", "targets": [ { "datasource": { "type": "prometheus", "uid": "$datasource" }, "expr": "round(sum (rate(istio_requests_total{reporter=~\"source|waypoint\",response_code=~\"5..\"}[$__rate_interval])), 0.01)or vector(0)", "refId": "A" } ], "title": "合計5xxステータス数", "type": "stat" }, { "datasource": { "type": "datasource", "uid": "-- Mixed --" }, "description": "Request information for HTTP services", "fieldConfig": { "defaults": { "custom": { "align": "auto", "cellOptions": { "type": "auto" }, "inspect": false }, "mappings": [], "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": null }, { "color": "red", "value": 80 } ] } }, "overrides": [ { "matcher": { "id": "byName", "options": "Value #requests" }, "properties": [ { "id": "displayName", "value": "リクエスト" }, { "id": "decimals", "value": 2 }, { "id": "unit", "value": "reqps" } ] }, { "matcher": { "id": "byName", "options": "Value #p50" }, "properties": [ { "id": "displayName", "value": "P50 レイテンシー" }, { "id": "decimals", "value": 2 }, { "id": "unit", "value": "ms" } ] }, { "matcher": { "id": "byName", "options": "Value #p90" }, "properties": [ { "id": "displayName", "value": "P90 レイテンシー" }, { "id": "decimals", "value": 2 }, { "id": "unit", "value": "ms" } ] }, { "matcher": { "id": "byName", "options": "Value #p99" }, "properties": [ { "id": "displayName", "value": "P99 レイテンシー" }, { "id": "decimals", "value": 2 }, { "id": "unit", "value": "ms" } ] }, { "matcher": { "id": "byName", "options": "Value #success" }, "properties": [ { "id": "displayName", "value": "リクエスト成功率" }, { "id": "decimals", "value": 2 }, { "id": "unit", "value": "percentunit" }, { "id": "custom.cellOptions", "value": { "type": "color-background" } }, { "id": "thresholds", "value": { "mode": "absolute", "steps": [ { "color": "red", "value": null }, { "color": "yellow", "value": "0.95" }, { "color": "green", "value": 1 } ] } } ] }, { "matcher": { "id": "byName", "options": "destination_workload_var" }, "properties": [ { "id": "displayName", "value": "Workload" } ] }, { "matcher": { "id": "byName", "options": "destination_service" }, "properties": [ { "id": "displayName", "value": "Service" }, { "id": "custom.minWidth", "value": 400 } ] }, { "matcher": { "id": "byName", "options": "destination_workload_namespace" }, "properties": [ { "id": "custom.hidden", "value": true } ] }, { "matcher": { "id": "byName", "options": "destination_workload" }, "properties": [ { "id": "custom.hidden", "value": true } ] }, { "matcher": { "id": "byName", "options": "Time" }, "properties": [ { "id": "custom.hidden", "value": true } ] } ] }, "gridPos": { "h": 16, "w": 24, "x": 0, "y": 5 }, "id": 6, "interval": "5s", "options": { "cellHeight": "sm", "footer": { "countRows": false, "fields": "", "reducer": [ "sum" ], "show": false }, "showHeader": true }, "pluginVersion": "11.5.2", "targets": [ { "datasource": { "type": "prometheus", "uid": "$datasource" }, "expr": "label_join(sum by (destination_workload,destination_workload_namespace,destination_service) (rate(istio_requests_total{reporter=~\"source|waypoint\"}[$__rate_interval])), \"destination_workload_var\", \".\", \"destination_workload\", \"destination_workload_namespace\")", "format": "table", "instant": true, "legendFormat": "{{ destination_workload}}.{{ destination_workload_namespace }}", "refId": "requests" }, { "datasource": { "type": "prometheus", "uid": "$datasource" }, "expr": "label_join(histogram_quantile(0.5, sum by (le,destination_workload,destination_workload_namespace) (rate(istio_request_duration_milliseconds_bucket{reporter=~\"source|waypoint\"}[$__rate_interval]))), \"destination_workload_var\", \".\", \"destination_workload\", \"destination_workload_namespace\")", "format": "table", "instant": true, "legendFormat": "{{ destination_workload}}.{{ destination_workload_namespace }}", "refId": "p50" }, { "datasource": { "type": "prometheus", "uid": "$datasource" }, "expr": "label_join(histogram_quantile(0.9, sum by (le,destination_workload,destination_workload_namespace) (rate(istio_request_duration_milliseconds_bucket{reporter=~\"source|waypoint\"}[$__rate_interval]))), \"destination_workload_var\", \".\", \"destination_workload\", \"destination_workload_namespace\")", "format": "table", "instant": true, "legendFormat": "{{ destination_workload}}.{{ destination_workload_namespace }}", "refId": "p90" }, { "datasource": { "type": "prometheus", "uid": "$datasource" }, "expr": "label_join(histogram_quantile(0.99, sum by (le,destination_workload,destination_workload_namespace) (rate(istio_request_duration_milliseconds_bucket{reporter=~\"source|waypoint\"}[$__rate_interval]))), \"destination_workload_var\", \".\", \"destination_workload\", \"destination_workload_namespace\")", "format": "table", "instant": true, "legendFormat": "{{ destination_workload}}.{{ destination_workload_namespace }}", "refId": "p99" }, { "datasource": { "type": "prometheus", "uid": "$datasource" }, "expr": "label_join(sum by (destination_workload,destination_workload_namespace) (rate(istio_requests_total{reporter=~\"source|waypoint\",response_code!~\"5..\"}[$__rate_interval]))/sum by (destination_workload,destination_workload_namespace) (rate(istio_requests_total{reporter=~\"source|waypoint\"}[$__rate_interval])), \"destination_workload_var\", \".\", \"destination_workload\", \"destination_workload_namespace\")", "format": "table", "instant": true, "legendFormat": "{{ destination_workload}}.{{ destination_workload_namespace }}", "refId": "success" } ], "title": "HTTP/gRPC Workloads", "transformations": [ { "id": "merge" } ], "type": "table" }, { "datasource": { "type": "datasource", "uid": "-- Mixed --" }, "description": "Bytes sent and recieived information for TCP services", "fieldConfig": { "defaults": { "custom": { "align": "auto", "cellOptions": { "type": "auto" }, "inspect": false }, "mappings": [], "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": null }, { "color": "red", "value": 80 } ] } }, "overrides": [ { "matcher": { "id": "byName", "options": "Value #recv" }, "properties": [ { "id": "displayName", "value": "受信バイトサイズ" }, { "id": "decimals", "value": 2 }, { "id": "unit", "value": "bps" } ] }, { "matcher": { "id": "byName", "options": "Value #sent" }, "properties": [ { "id": "displayName", "value": "送信バイトサイズ" }, { "id": "decimals", "value": 2 }, { "id": "unit", "value": "bps" } ] }, { "matcher": { "id": "byName", "options": "destination_workload_var" }, "properties": [ { "id": "displayName", "value": "Workload" } ] }, { "matcher": { "id": "byName", "options": "destination_service" }, "properties": [ { "id": "displayName", "value": "Service" }, { "id": "custom.minWidth", "value": 400 } ] }, { "matcher": { "id": "byName", "options": "destination_workload_namespace" }, "properties": [ { "id": "custom.hidden", "value": true } ] }, { "matcher": { "id": "byName", "options": "destination_workload" }, "properties": [ { "id": "custom.hidden", "value": true } ] }, { "matcher": { "id": "byName", "options": "Time" }, "properties": [ { "id": "custom.hidden", "value": true } ] } ] }, "gridPos": { "h": 16, "w": 24, "x": 0, "y": 21 }, "id": 7, "interval": "5s", "options": { "cellHeight": "sm", "footer": { "countRows": false, "fields": "", "reducer": [ "sum" ], "show": false }, "showHeader": true }, "pluginVersion": "11.5.2", "targets": [ { "datasource": { "type": "prometheus", "uid": "$datasource" }, "expr": "label_join(sum by (destination_workload,destination_workload_namespace,destination_service) (rate(istio_tcp_received_bytes_total{reporter=~\"source|waypoint\"}[$__rate_interval])), \"destination_workload_var\", \".\", \"destination_workload\", \"destination_workload_namespace\")", "format": "table", "instant": true, "legendFormat": "{{ destination_workload}}.{{ destination_workload_namespace }}", "refId": "recv" }, { "datasource": { "type": "prometheus", "uid": "$datasource" }, "expr": "label_join(sum by (destination_workload,destination_workload_namespace,destination_service) (rate(istio_tcp_sent_bytes_total{reporter=~\"source|waypoint\"}[$__rate_interval])), \"destination_workload_var\", \".\", \"destination_workload\", \"destination_workload_namespace\")", "format": "table", "instant": true, "legendFormat": "{{ destination_workload}}.{{ destination_workload_namespace }}", "refId": "sent" } ], "title": "TCP Workloads", "transformations": [ { "id": "merge" } ], "type": "table" } ], "preload": false, "refresh": "15s", "schemaVersion": 40, "tags": [ "istio" ], "templating": { "list": [ { "current": { "text": "Prometheus", "value": "PBFA97CFB590B2093" }, "name": "datasource", "options": [], "query": "prometheus", "refresh": 1, "type": "datasource" } ] }, "time": { "from": "now-30m", "to": "now" }, "timepicker": {}, "timezone": "utc", "title": "Istioサービスメッシュ (ネットワーク)", "uid": "", "version": 1, "weekStart": "" }'

dashboardProviders:
  dasboardproviders.yaml:
    apiVersion: 1
    providers:
      - name: local
        options:
          path: /var/lib/grafana/dashboards/local

resources:
  requests:
    cpu: 100m
    memory: 256Mi
  limits:
    memory: 256Mi
