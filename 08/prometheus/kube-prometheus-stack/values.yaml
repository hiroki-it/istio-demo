alertmanager:
  alertmanagerSpec:
    affinity:
      nodeAffinity:
        requiredDuringSchedulingIgnoredDuringExecution:
          nodeSelectorTerms:
            - matchExpressions:
                - key: node.kubernetes.io/nodegroup
                  operator: In
                  values:
                    - system
  service:
    type: NodePort
    nodePort: 32001

grafana:
  hosts:
    - bookinfo.grafana.com
  grafana.ini:
    auth.anonymous:
      enabled: true
      org_role: Admin
  service:
    type: NodePort
    nodePort: 32003
  additionalDataSources:
    - name: Loki
      type: loki
      url: http://grafana-loki.istio-system.svc.cluster.local:3100/
      basicAuth: false
    - name: Tempo
      type: tempo
      url: http://grafana-tempo.istio-system.svc.cluster.local:3100/
      basicAuth: false

prometheus:
  prometheusSpec:
    affinity:
      nodeAffinity:
        requiredDuringSchedulingIgnoredDuringExecution:
          nodeSelectorTerms:
            - matchExpressions:
                - key: node.kubernetes.io/nodegroup
                  operator: In
                  values:
                    - system
    additionalScrapeConfigs:
      # Istiodの監視
      - job_name: istiod
        kubernetes_sd_configs:
          - role: endpoints
            namespaces:
              names:
                - istio-system
        relabel_configs:
          - source_labels:
              - __meta_kubernetes_service_name
              - __meta_kubernetes_endpoint_port_name
            action: keep
            regex: istiod;http-monitoring
      # istio-proxyの監視
      - job_name: istio-proxy
        metrics_path: /stats/prometheus
        kubernetes_sd_configs:
          - role: pod
        relabel_configs:
          - source_labels:
              - __meta_kubernetes_pod_container_port_name
            action: keep
            regex: .*-envoy-prom
  service:
    type: NodePort
    nodePort: 32004
