grafana.ini:
  auth.anonymous:
    enabled: true
    org_role: Admin
  date_formats:
    default_timezone: Asia/Tokyo
    default_week_start: monday
  users:
    default_theme: light
    default_language: ja-JP

affinity:
  nodeAffinity:
    requiredDuringSchedulingIgnoredDuringExecution:
      nodeSelectorTerms:
        - matchExpressions:
            - key: node.kubernetes.io/nodegroup
              operator: In
              values:
                - system

replicas: 2

service:
  type: NodePort
  nodePort: 32003

datasources:
  datasources.yaml:
    apiVersion: 1
    datasources:
      - name: Prometheus
        type: prometheus
        url: http://prometheus-server.prometheus.svc.cluster.local:9090
        isDefault: true

dashboards:
  local:
    kubernetes-deployment-hardware-resources:
      json: '{ "annotations": { "list": [ { "builtIn": 1, "datasource": { "type": "grafana", "uid": "-- Grafana --" }, "enable": true, "hide": true, "iconColor": "rgba(0, 211, 255, 1)", "name": "Annotations & Alerts", "type": "dashboard" } ] }, "description": "Kubernetes DeploymentによるCPUやメモリを可視化する", "editable": true, "fiscalYearStartMonth": 0, "graphTooltip": 0, "id": 5, "links": [], "panels": [ { "collapsed": false, "gridPos": { "h": 1, "w": 24, "x": 0, "y": 0 }, "id": 48, "panels": [], "title": "CPU", "type": "row" }, { "datasource": { "uid": "$datasource" }, "fieldConfig": { "defaults": { "color": { "mode": "palette-classic" }, "custom": { "axisBorderShow": false, "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "CPU使用率", "axisPlacement": "auto", "barAlignment": 0, "barWidthFactor": 0.6, "drawStyle": "line", "fillOpacity": 0, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "insertNulls": false, "lineInterpolation": "linear", "lineWidth": 1, "pointSize": 4, "scaleDistribution": { "type": "linear" }, "showPoints": "always", "spanNulls": true, "stacking": { "group": "A", "mode": "none" }, "thresholdsStyle": { "mode": "off" } }, "mappings": [], "max": 100, "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": 0 } ] }, "unit": "percent" }, "overrides": [] }, "gridPos": { "h": 8, "w": 24, "x": 0, "y": 1 }, "id": 45, "options": { "legend": { "calcs": [ "mean", "lastNotNull" ], "displayMode": "table", "placement": "right", "showLegend": true }, "tooltip": { "hideZeros": false, "mode": "multi", "sort": "desc" } }, "pluginVersion": "12.1.1", "targets": [ { "datasource": { "uid": "$datasource" }, "editorMode": "code", "expr": "sum (rate (container_cpu_usage_seconds_total{image!=\"\", container!=\"POD\",pod=~\"^$Deployment.*$\", namespace=~\"$Namespace\"}[1m])) by (pod) / sum(kube_pod_container_resource_limits{resource=\"cpu\", container!=\"POD\", pod=~\"^$Deployment.*$\", namespace=~\"$Namespace\"}) by (pod) * 100", "hide": false, "interval": "10s", "intervalFactor": 1, "legendFormat": "pod: {{ pod }}", "metric": "container_cpu", "range": true, "refId": "A", "step": 10 } ], "title": "Pod単位のCPU使用率（実際値/limits）", "type": "timeseries" }, { "datasource": { "uid": "$datasource" }, "fieldConfig": { "defaults": { "color": { "mode": "palette-classic" }, "custom": { "axisBorderShow": false, "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "CPU使用率", "axisPlacement": "auto", "barAlignment": 0, "barWidthFactor": 0.6, "drawStyle": "line", "fillOpacity": 0, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "insertNulls": false, "lineInterpolation": "linear", "lineWidth": 1, "pointSize": 4, "scaleDistribution": { "type": "linear" }, "showPoints": "always", "spanNulls": true, "stacking": { "group": "A", "mode": "none" }, "thresholdsStyle": { "mode": "off" } }, "mappings": [], "max": 100, "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": 0 } ] }, "unit": "percent" }, "overrides": [] }, "gridPos": { "h": 8, "w": 24, "x": 0, "y": 9 }, "id": 46, "options": { "legend": { "calcs": [ "mean", "lastNotNull" ], "displayMode": "table", "placement": "right", "showLegend": true }, "tooltip": { "hideZeros": false, "mode": "multi", "sort": "desc" } }, "pluginVersion": "12.1.1", "targets": [ { "datasource": { "uid": "$datasource" }, "editorMode": "code", "expr": "sum (rate (container_cpu_usage_seconds_total{image!=\"\", container!=\"POD\",pod=~\"^$Deployment.*$\", namespace=~\"$Namespace\"}[1m])) by (container) / sum(kube_pod_container_resource_limits{resource=\"cpu\", container!=\"POD\", pod=~\"^$Deployment.*$\", namespace=~\"$Namespace\"}) by (container) * 100", "hide": false, "interval": "10s", "intervalFactor": 1, "legendFormat": "container: {{ container }}", "metric": "container_cpu", "range": true, "refId": "A", "step": 10 } ], "title": "コンテナ単位のCPU使用率（実際値/limits）", "type": "timeseries" }, { "collapsed": false, "gridPos": { "h": 1, "w": 24, "x": 0, "y": 17 }, "id": 47, "panels": [], "title": "メモリ", "type": "row" }, { "datasource": { "uid": "$datasource" }, "fieldConfig": { "defaults": { "color": { "mode": "palette-classic" }, "custom": { "axisBorderShow": false, "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "メモリ使用率", "axisPlacement": "auto", "barAlignment": 0, "barWidthFactor": 0.6, "drawStyle": "line", "fillOpacity": 0, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "insertNulls": false, "lineInterpolation": "linear", "lineWidth": 1, "pointSize": 4, "scaleDistribution": { "type": "linear" }, "showPoints": "always", "spanNulls": true, "stacking": { "group": "A", "mode": "none" }, "thresholdsStyle": { "mode": "off" } }, "mappings": [], "max": 100, "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": 0 } ] }, "unit": "percent" }, "overrides": [] }, "gridPos": { "h": 8, "w": 24, "x": 0, "y": 18 }, "id": 25, "options": { "legend": { "calcs": [ "mean", "lastNotNull" ], "displayMode": "table", "placement": "right", "showLegend": true }, "tooltip": { "hideZeros": false, "mode": "multi", "sort": "desc" } }, "pluginVersion": "12.1.1", "targets": [ { "datasource": { "uid": "$datasource" }, "expr": "sum (container_memory_working_set_bytes{image!=\"\", container!=\"POD\", pod=~\"^$Deployment.*$\", namespace=~\"$Namespace\"}) by (pod) / sum(kube_pod_container_resource_limits{resource=\"memory\", container!=\"POD\", pod=~\"^$Deployment.*$\", namespace=~\"$Namespace\"}) by (pod) * 100", "interval": "10s", "intervalFactor": 1, "legendFormat": "pod: {{ pod }}", "metric": "container_memory_usage:sort_desc", "refId": "A", "step": 10 } ], "title": "Pod単位のメモリ使用率（実際値/limits）", "type": "timeseries" }, { "datasource": { "uid": "$datasource" }, "fieldConfig": { "defaults": { "color": { "mode": "palette-classic" }, "custom": { "axisBorderShow": false, "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "メモリ使用率", "axisPlacement": "auto", "barAlignment": 0, "barWidthFactor": 0.6, "drawStyle": "line", "fillOpacity": 0, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "insertNulls": false, "lineInterpolation": "linear", "lineWidth": 1, "pointSize": 4, "scaleDistribution": { "type": "linear" }, "showPoints": "always", "spanNulls": true, "stacking": { "group": "A", "mode": "none" }, "thresholdsStyle": { "mode": "off" } }, "mappings": [], "max": 100, "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": 0 } ] }, "unit": "percent" }, "overrides": [] }, "gridPos": { "h": 8, "w": 24, "x": 0, "y": 26 }, "id": 44, "options": { "legend": { "calcs": [ "mean", "lastNotNull" ], "displayMode": "table", "placement": "right", "showLegend": true, "sortBy": "Name", "sortDesc": true }, "tooltip": { "hideZeros": false, "mode": "multi", "sort": "desc" } }, "pluginVersion": "12.1.1", "targets": [ { "datasource": { "uid": "$datasource" }, "editorMode": "code", "expr": "sum (container_memory_working_set_bytes{image!=\"\", container!=\"POD\", pod=~\"^$Deployment.*$\", namespace=~\"$Namespace\"}) by (container) / sum(kube_pod_container_resource_limits{resource=\"memory\", container!=\"POD\", pod=~\"^$Deployment.*$\", namespace=~\"$Namespace\"}) by (container) * 100", "interval": "10s", "intervalFactor": 1, "legendFormat": "container: {{ container }}", "metric": "container_memory_usage:sort_desc", "range": true, "refId": "A", "step": 10 } ], "title": "コンテナ単位のメモリ使用率（実際値/limits）", "type": "timeseries" } ], "preload": false, "refresh": "10s", "schemaVersion": 41, "tags": [ "metrics" ], "templating": { "list": [ { "current": { "text": "default", "value": "default" }, "label": "Data Source", "name": "datasource", "options": [], "query": "prometheus", "refresh": 1, "regex": "", "type": "datasource" }, { "allValue": ".*", "current": {}, "datasource": "$datasource", "includeAll": false, "name": "Namespace", "options": [], "query": "label_values(kube_deployment_created, namespace)", "refresh": 1, "type": "query" }, { "allValue": ".*", "current": {}, "datasource": "$datasource", "includeAll": false, "name": "Deployment", "options": [], "query": "label_values(kube_deployment_created{namespace=~\"$Namespace\"}, deployment)", "refresh": 1, "type": "query" } ] }, "time": { "from": "now-30m", "to": "now" }, "timepicker": {}, "timezone": "", "title": "Kubernetes DeploymentによるCPUやメモリ", "uid": "aeg6z6rw4mps0f", "version": 1 }'
    kubernetes-statefulset-hardware-resources:
      json: '{ "annotations": { "list": [ { "builtIn": 1, "datasource": { "type": "grafana", "uid": "-- Grafana --" }, "enable": true, "hide": true, "iconColor": "rgba(0, 211, 255, 1)", "name": "Annotations & Alerts", "type": "dashboard" } ] }, "description": "Kubernetes StatefulSetのCPUやメモリを可視化する", "editable": true, "fiscalYearStartMonth": 0, "graphTooltip": 0, "id": 6, "links": [], "panels": [ { "collapsed": false, "gridPos": { "h": 1, "w": 24, "x": 0, "y": 0 }, "id": 48, "panels": [], "title": "CPU", "type": "row" }, { "datasource": { "uid": "$datasource" }, "fieldConfig": { "defaults": { "color": { "mode": "palette-classic" }, "custom": { "axisBorderShow": false, "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "CPU使用率", "axisPlacement": "auto", "barAlignment": 0, "barWidthFactor": 0.6, "drawStyle": "line", "fillOpacity": 0, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "insertNulls": false, "lineInterpolation": "linear", "lineWidth": 1, "pointSize": 4, "scaleDistribution": { "type": "linear" }, "showPoints": "always", "spanNulls": true, "stacking": { "group": "A", "mode": "none" }, "thresholdsStyle": { "mode": "off" } }, "mappings": [], "max": 100, "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": 0 } ] }, "unit": "percent" }, "overrides": [] }, "gridPos": { "h": 8, "w": 24, "x": 0, "y": 1 }, "id": 45, "options": { "legend": { "calcs": [ "mean", "lastNotNull" ], "displayMode": "table", "placement": "right", "showLegend": true }, "tooltip": { "hideZeros": false, "mode": "multi", "sort": "desc" } }, "pluginVersion": "12.1.1", "targets": [ { "datasource": { "uid": "$datasource" }, "editorMode": "code", "expr": "sum (rate (container_cpu_usage_seconds_total{image!=\"\", container!=\"POD\",pod=~\"^$StatefulSet.*$\", namespace=~\"$Namespace\"}[1m])) by (pod) / sum(kube_pod_container_resource_limits{resource=\"cpu\", container!=\"POD\", pod=~\"^$StatefulSet.*$\", namespace=~\"$Namespace\"}) by (pod) * 100", "hide": false, "interval": "10s", "intervalFactor": 1, "legendFormat": "pod: {{ pod }}", "metric": "container_cpu", "range": true, "refId": "A", "step": 10 } ], "title": "Pod単位のCPU使用率（実際値/limits）", "type": "timeseries" }, { "datasource": { "uid": "$datasource" }, "fieldConfig": { "defaults": { "color": { "mode": "palette-classic" }, "custom": { "axisBorderShow": false, "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "CPU使用率", "axisPlacement": "auto", "barAlignment": 0, "barWidthFactor": 0.6, "drawStyle": "line", "fillOpacity": 0, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "insertNulls": false, "lineInterpolation": "linear", "lineWidth": 1, "pointSize": 4, "scaleDistribution": { "type": "linear" }, "showPoints": "always", "spanNulls": true, "stacking": { "group": "A", "mode": "none" }, "thresholdsStyle": { "mode": "off" } }, "mappings": [], "max": 100, "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": 0 } ] }, "unit": "percent" }, "overrides": [] }, "gridPos": { "h": 8, "w": 24, "x": 0, "y": 9 }, "id": 46, "options": { "legend": { "calcs": [ "mean", "lastNotNull" ], "displayMode": "table", "placement": "right", "showLegend": true }, "tooltip": { "hideZeros": false, "mode": "multi", "sort": "desc" } }, "pluginVersion": "12.1.1", "targets": [ { "datasource": { "uid": "$datasource" }, "editorMode": "code", "expr": "sum (rate (container_cpu_usage_seconds_total{image!=\"\", container!=\"POD\",pod=~\"^$StatefulSet.*$\", namespace=~\"$Namespace\"}[1m])) by (container) / sum(kube_pod_container_resource_limits{resource=\"cpu\", container!=\"POD\", pod=~\"^$StatefulSet.*$\", namespace=~\"$Namespace\"}) by (container) * 100", "hide": false, "interval": "10s", "intervalFactor": 1, "legendFormat": "container: {{ container }}", "metric": "container_cpu", "range": true, "refId": "A", "step": 10 } ], "title": "コンテナ単位のCPU使用率（実際値/limits）", "type": "timeseries" }, { "collapsed": false, "gridPos": { "h": 1, "w": 24, "x": 0, "y": 17 }, "id": 47, "panels": [], "title": "メモリ", "type": "row" }, { "datasource": { "uid": "$datasource" }, "fieldConfig": { "defaults": { "color": { "mode": "palette-classic" }, "custom": { "axisBorderShow": false, "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "メモリ使用率", "axisPlacement": "auto", "barAlignment": 0, "barWidthFactor": 0.6, "drawStyle": "line", "fillOpacity": 0, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "insertNulls": false, "lineInterpolation": "linear", "lineWidth": 1, "pointSize": 4, "scaleDistribution": { "type": "linear" }, "showPoints": "always", "spanNulls": true, "stacking": { "group": "A", "mode": "none" }, "thresholdsStyle": { "mode": "off" } }, "mappings": [], "max": 100, "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": 0 } ] }, "unit": "percent" }, "overrides": [] }, "gridPos": { "h": 8, "w": 24, "x": 0, "y": 18 }, "id": 25, "options": { "legend": { "calcs": [ "mean", "lastNotNull" ], "displayMode": "table", "placement": "right", "showLegend": true }, "tooltip": { "hideZeros": false, "mode": "multi", "sort": "desc" } }, "pluginVersion": "12.1.1", "targets": [ { "datasource": { "uid": "$datasource" }, "expr": "sum (container_memory_working_set_bytes{image!=\"\", container!=\"POD\", pod=~\"^$StatefulSet.*$\", namespace=~\"$Namespace\"}) by (pod) / sum(kube_pod_container_resource_limits{resource=\"memory\", container!=\"POD\", pod=~\"^$StatefulSet.*$\", namespace=~\"$Namespace\"}) by (pod) * 100", "interval": "10s", "intervalFactor": 1, "legendFormat": "pod: {{ pod }}", "metric": "container_memory_usage:sort_desc", "refId": "A", "step": 10 } ], "title": "Pod単位のメモリ使用率（実際値/limits）", "type": "timeseries" }, { "datasource": { "uid": "$datasource" }, "fieldConfig": { "defaults": { "color": { "mode": "palette-classic" }, "custom": { "axisBorderShow": false, "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "メモリ使用率", "axisPlacement": "auto", "barAlignment": 0, "barWidthFactor": 0.6, "drawStyle": "line", "fillOpacity": 0, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "insertNulls": false, "lineInterpolation": "linear", "lineWidth": 1, "pointSize": 4, "scaleDistribution": { "type": "linear" }, "showPoints": "always", "spanNulls": true, "stacking": { "group": "A", "mode": "none" }, "thresholdsStyle": { "mode": "off" } }, "mappings": [], "max": 100, "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": 0 } ] }, "unit": "percent" }, "overrides": [] }, "gridPos": { "h": 8, "w": 24, "x": 0, "y": 26 }, "id": 44, "options": { "legend": { "calcs": [ "mean", "lastNotNull" ], "displayMode": "table", "placement": "right", "showLegend": true, "sortBy": "Name", "sortDesc": true }, "tooltip": { "hideZeros": false, "mode": "multi", "sort": "desc" } }, "pluginVersion": "12.1.1", "targets": [ { "datasource": { "uid": "$datasource" }, "editorMode": "code", "expr": "sum (container_memory_working_set_bytes{image!=\"\", container!=\"POD\", pod=~\"^$StatefulSet.*$\", namespace=~\"$Namespace\"}) by (container) / sum(kube_pod_container_resource_limits{resource=\"memory\", container!=\"POD\", pod=~\"^$StatefulSet.*$\", namespace=~\"$Namespace\"}) by (container) * 100", "interval": "10s", "intervalFactor": 1, "legendFormat": "container: {{ container }}", "metric": "container_memory_usage:sort_desc", "range": true, "refId": "A", "step": 10 } ], "title": "コンテナ単位のメモリ使用率（実際値/limits）", "type": "timeseries" } ], "preload": false, "refresh": "10s", "schemaVersion": 41, "tags": [ "metrics" ], "templating": { "list": [ { "current": { "text": "default", "value": "default" }, "label": "Data Source", "name": "datasource", "options": [], "query": "prometheus", "refresh": 1, "regex": "", "type": "datasource" }, { "allValue": ".*", "current": {}, "datasource": "$datasource", "includeAll": false, "name": "Namespace", "options": [], "query": "label_values(kube_statefulset_created, namespace)", "refresh": 1, "type": "query" }, { "allValue": ".*", "current": {}, "datasource": "$datasource", "includeAll": false, "name": "StatefulSet", "options": [], "query": "label_values(kube_statefulset_created{namespace=~\"$Namespace\"}, statefulset)", "refresh": 1, "type": "query" } ] }, "time": { "from": "now-30m", "to": "now" }, "timepicker": {}, "timezone": "", "title": "Kubernetes StatefulSetによるCPUやメモリ", "uid": "feg6z6jpo3mdcc", "version": 1 }'
    istio-service-mesh-common-http:
      json: '{ "annotations": { "list": [ { "builtIn": 1, "datasource": { "type": "grafana", "uid": "-- Grafana --" }, "enable": true, "hide": true, "iconColor": "rgba(0, 211, 255, 1)", "name": "Annotations & Alerts", "type": "dashboard" } ] }, "description": "IstioによるHTTPプロトコルを可視化する", "editable": true, "fiscalYearStartMonth": 0, "graphTooltip": 1, "id": 8, "links": [], "panels": [ { "datasource": { "type": "datasource", "uid": "$datasource" }, "fieldConfig": { "defaults": { "color": { "fixedColor": "blue", "mode": "fixed" }, "custom": { "axisBorderShow": false, "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "barWidthFactor": 0.6, "drawStyle": "line", "fillOpacity": 0, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "insertNulls": false, "lineInterpolation": "linear", "lineWidth": 1, "pointSize": 4, "scaleDistribution": { "type": "linear" }, "showPoints": "always", "spanNulls": true, "stacking": { "group": "A", "mode": "none" }, "thresholdsStyle": { "mode": "off" } }, "mappings": [], "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": 0 } ] }, "unit": "reqpm" }, "overrides": [] }, "gridPos": { "h": 8, "w": 24, "x": 0, "y": 0 }, "id": 2, "interval": "5s", "options": { "legend": { "calcs": [ "mean", "lastNotNull" ], "displayMode": "table", "placement": "right", "showLegend": true }, "tooltip": { "hideZeros": false, "mode": "single", "sort": "none" } }, "pluginVersion": "12.1.1", "targets": [ { "datasource": { "type": "prometheus", "uid": "$datasource" }, "editorMode": "code", "expr": "sum(rate(istio_requests_total{source_workload=~\"$Source\",destination_workload=~\"$Destination\",source_workload_namespace=~\"$Namespace\", reporter=~\"source|waypoint\", request_protocol=~\"http|grpc\"}[5m])) by (source_workload, destination_workload) * 60", "legendFormat": "{{ source_workload }} ⇄ {{ destination_workload }}", "range": true, "refId": "A" } ], "title": "リクエストのスループット", "type": "timeseries" }, { "datasource": { "type": "datasource", "uid": "$datasource" }, "fieldConfig": { "defaults": { "color": { "fixedColor": "blue", "mode": "fixed" }, "custom": { "axisBorderShow": false, "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "barWidthFactor": 0.6, "drawStyle": "line", "fillOpacity": 0, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "insertNulls": false, "lineInterpolation": "linear", "lineWidth": 1, "pointSize": 4, "scaleDistribution": { "type": "linear" }, "showPoints": "always", "spanNulls": true, "stacking": { "group": "A", "mode": "none" }, "thresholdsStyle": { "mode": "off" } }, "mappings": [], "max": 5000, "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": 0 } ] }, "unit": "ms" }, "overrides": [ { "__systemRef": "hideSeriesFrom", "matcher": { "id": "byNames", "options": { "mode": "exclude", "names": [ "productpage-v1 ⇄ details-v2" ], "prefix": "All except:", "readOnly": true } }, "properties": [ { "id": "custom.hideFrom", "value": { "legend": false, "tooltip": false, "viz": true } } ] } ] }, "gridPos": { "h": 8, "w": 24, "x": 0, "y": 8 }, "id": 9, "interval": "5s", "options": { "legend": { "calcs": [ "mean", "lastNotNull" ], "displayMode": "table", "placement": "right", "showLegend": true }, "tooltip": { "hideZeros": false, "mode": "single", "sort": "none" } }, "pluginVersion": "12.1.1", "targets": [ { "datasource": { "type": "prometheus", "uid": "$datasource" }, "editorMode": "code", "expr": "sum(rate(istio_request_duration_milliseconds_sum{source_workload=~\"$Source\",destination_workload=~\"$Destination\",source_workload_namespace=~\"$Namespace\", reporter=~\"source|waypoint\", request_protocol=~\"http|grpc\"}[5m])) by (source_workload, destination_workload) / sum(rate(istio_request_duration_milliseconds_count{source_workload=~\"$Source\",destination_workload=~\"$Destination\",source_workload_namespace=~\"$Namespace\", reporter=~\"source|waypoint\", request_protocol=~\"http|grpc\"}[5m])) by (source_workload, destination_workload)", "legendFormat": "{{ source_workload }} ⇄ {{ destination_workload }}", "range": true, "refId": "A" } ], "title": "レスポンス時間", "type": "timeseries" }, { "datasource": { "type": "datasource", "uid": "$datasource" }, "fieldConfig": { "defaults": { "color": { "fixedColor": "blue", "mode": "palette-classic" }, "custom": { "axisBorderShow": false, "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "barWidthFactor": 0.6, "drawStyle": "line", "fillOpacity": 0, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "insertNulls": false, "lineInterpolation": "linear", "lineWidth": 1, "pointSize": 4, "scaleDistribution": { "type": "linear" }, "showPoints": "always", "spanNulls": true, "stacking": { "group": "A", "mode": "none" }, "thresholdsStyle": { "mode": "off" } }, "mappings": [], "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": 0 } ] }, "unit": "cpm" }, "overrides": [] }, "gridPos": { "h": 8, "w": 24, "x": 0, "y": 16 }, "id": 11, "interval": "5s", "options": { "legend": { "calcs": [ "mean", "lastNotNull" ], "displayMode": "table", "placement": "right", "showLegend": true }, "tooltip": { "hideZeros": false, "mode": "single", "sort": "none" } }, "pluginVersion": "12.1.1", "targets": [ { "datasource": { "type": "prometheus", "uid": "$datasource" }, "editorMode": "code", "expr": "sort(sum(rate(istio_requests_total{source_workload=~\"$Source\",destination_workload=~\"$Destination\",source_workload_namespace=~\"$Namespace\", reporter=~\"source|waypoint\", request_protocol=~\"http|grpc\"}[5m]) * 60 ) by (source_workload, destination_workload, response_code, response_flags))", "legendFormat": "{{ source_workload }} ⇄  {{ destination_workload }} | {{ response_code }} | {{ response_flags }}", "range": true, "refId": "A" } ], "title": "各response_flagsラベルで集計したレスポンスステータス数", "type": "timeseries" }, { "datasource": { "type": "datasource", "uid": "$datasource" }, "fieldConfig": { "defaults": { "color": { "fixedColor": "blue", "mode": "fixed" }, "custom": { "axisBorderShow": false, "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "barWidthFactor": 0.6, "drawStyle": "line", "fillOpacity": 0, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "insertNulls": false, "lineInterpolation": "linear", "lineWidth": 1, "pointSize": 4, "scaleDistribution": { "type": "linear" }, "showPoints": "always", "spanNulls": true, "stacking": { "group": "A", "mode": "none" }, "thresholdsStyle": { "mode": "off" } }, "mappings": [], "max": 100, "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": 0 } ] }, "unit": "percent" }, "overrides": [] }, "gridPos": { "h": 8, "w": 24, "x": 0, "y": 24 }, "id": 10, "interval": "5s", "options": { "legend": { "calcs": [ "mean", "lastNotNull" ], "displayMode": "table", "placement": "right", "showLegend": true }, "tooltip": { "hideZeros": false, "mode": "single", "sort": "none" } }, "pluginVersion": "12.1.1", "targets": [ { "datasource": { "type": "prometheus", "uid": "$datasource" }, "editorMode": "code", "expr": "sum(rate(istio_requests_total{source_workload=~\"$Source\",destination_workload=~\"$Destination\",source_workload_namespace=~\"$Namespace\", reporter=~\"source|waypoint\",response_code=~\"2..\",request_protocol=~\"http|grpc\"}[5m])) by (source_workload,destination_workload) / sum(rate(istio_requests_total{source_workload=~\"$Source\",destination_workload=~\"$Destination\",source_workload_namespace=~\"$Namespace\", reporter=~\"source|waypoint\",request_protocol=~\"http|grpc\"}[5m])) by (source_workload,destination_workload) * 100", "legendFormat": "{{ source_workload }} ⇄ {{ destination_workload }}", "range": true, "refId": "A" } ], "title": "2xxレスポンスの受信率（2xxレスポンス/全レスポンス）", "type": "timeseries" }, { "datasource": { "type": "datasource", "uid": "$datasource" }, "fieldConfig": { "defaults": { "color": { "fixedColor": "blue", "mode": "fixed" }, "custom": { "axisBorderShow": false, "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "barWidthFactor": 0.6, "drawStyle": "line", "fillOpacity": 0, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "insertNulls": false, "lineInterpolation": "linear", "lineWidth": 1, "pointSize": 4, "scaleDistribution": { "type": "linear" }, "showPoints": "always", "spanNulls": true, "stacking": { "group": "A", "mode": "none" }, "thresholdsStyle": { "mode": "off" } }, "mappings": [], "max": 100, "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": 0 } ] }, "unit": "percent" }, "overrides": [] }, "gridPos": { "h": 8, "w": 24, "x": 0, "y": 32 }, "id": 4, "interval": "5s", "options": { "legend": { "calcs": [ "mean", "lastNotNull" ], "displayMode": "table", "placement": "right", "showLegend": true }, "tooltip": { "hideZeros": false, "mode": "single", "sort": "none" } }, "pluginVersion": "12.1.1", "targets": [ { "datasource": { "type": "prometheus", "uid": "$datasource" }, "editorMode": "code", "expr": "sum(rate(istio_requests_total{source_workload=~\"$Source\",destination_workload=~\"$Destination\",source_workload_namespace=~\"$Namespace\", reporter=~\"source|waypoint\",response_code=~\"4..\",request_protocol=~\"http|grpc\"}[5m])) by (source_workload,destination_workload) / sum(rate(istio_requests_total{source_workload=~\"$Source\",destination_workload=~\"$Destination\",source_workload_namespace=~\"$Namespace\", reporter=~\"source|waypoint\",request_protocol=~\"http|grpc\"}[5m])) by (source_workload,destination_workload) * 100", "format": "time_series", "interval": "", "legendFormat": "{{ source_workload }} ⇄ {{ destination_workload }}", "range": true, "refId": "A" } ], "title": "4xxレスポンスの受信率（4xxレスポンス/全レスポンス）", "type": "timeseries" }, { "datasource": { "type": "datasource", "uid": "$datasource" }, "fieldConfig": { "defaults": { "color": { "fixedColor": "blue", "mode": "fixed" }, "custom": { "axisBorderShow": false, "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "barWidthFactor": 0.6, "drawStyle": "line", "fillOpacity": 0, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "insertNulls": false, "lineInterpolation": "linear", "lineWidth": 1, "pointSize": 4, "scaleDistribution": { "type": "linear" }, "showPoints": "always", "spanNulls": true, "stacking": { "group": "A", "mode": "none" }, "thresholdsStyle": { "mode": "off" } }, "fieldMinMax": false, "mappings": [], "max": 100, "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": 0 } ] }, "unit": "percent" }, "overrides": [] }, "gridPos": { "h": 8, "w": 24, "x": 0, "y": 40 }, "id": 5, "interval": "5s", "options": { "legend": { "calcs": [ "mean", "lastNotNull" ], "displayMode": "table", "placement": "right", "showLegend": true }, "tooltip": { "hideZeros": false, "mode": "single", "sort": "none" } }, "pluginVersion": "12.1.1", "targets": [ { "datasource": { "type": "prometheus", "uid": "$datasource" }, "disableTextWrap": false, "editorMode": "code", "expr": "sum(rate(istio_requests_total{source_workload=~\"$Source\",destination_workload=~\"$Destination\",source_workload_namespace=~\"$Namespace\", reporter=~\"source|waypoint\",response_code=~\"5..\",request_protocol=~\"http|grpc\"}[5m])) by (source_workload,destination_workload) / sum(rate(istio_requests_total{source_workload=~\"$Source\",destination_workload=~\"$Destination\",source_workload_namespace=~\"$Namespace\", reporter=~\"source|waypoint\",request_protocol=~\"http|grpc\"}[5m])) by (source_workload,destination_workload) * 100", "fullMetaSearch": false, "includeNullMetadata": true, "legendFormat": "{{ source_workload }} ⇄ {{ destination_workload }}", "range": true, "refId": "A", "useBackend": false } ], "title": "5xxレスポンスの受信率（5xxレスポンス/全レスポンス）", "type": "timeseries" }, { "datasource": { "type": "datasource", "uid": "$datasource" }, "fieldConfig": { "defaults": { "color": { "fixedColor": "blue", "mode": "fixed" }, "custom": { "axisBorderShow": false, "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "barWidthFactor": 0.6, "drawStyle": "line", "fillOpacity": 0, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "insertNulls": false, "lineInterpolation": "linear", "lineWidth": 1, "pointSize": 4, "scaleDistribution": { "type": "linear" }, "showPoints": "always", "spanNulls": true, "stacking": { "group": "A", "mode": "none" }, "thresholdsStyle": { "mode": "off" } }, "mappings": [], "max": 100, "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": 0 } ] }, "unit": "percent" }, "overrides": [] }, "gridPos": { "h": 8, "w": 24, "x": 0, "y": 48 }, "id": 3, "interval": "5s", "options": { "legend": { "calcs": [ "mean", "lastNotNull" ], "displayMode": "table", "placement": "right", "showLegend": true }, "tooltip": { "hideZeros": false, "mode": "single", "sort": "none" } }, "pluginVersion": "12.1.1", "targets": [ { "datasource": { "type": "prometheus", "uid": "$datasource" }, "editorMode": "code", "expr": "sum(rate(istio_requests_total{source_workload=~\"$Source\",destination_workload=~\"$Destination\",source_workload_namespace=~\"$Namespace\", reporter=~\"source|waypoint\",response_code=~\"0\",request_protocol=~\"http|grpc\"}[5m])) by (source_workload,destination_workload) / sum(rate(istio_requests_total{source_workload=~\"$Source\",destination_workload=~\"$Destination\",source_workload_namespace=~\"$Namespace\", reporter=~\"source|waypoint\",request_protocol=~\"http|grpc\"}[5m])) by (source_workload,destination_workload) * 100", "legendFormat": "{{ source_workload }} ⇄ {{ destination_workload }}", "range": true, "refId": "A" } ], "title": "レスポンス未返信（0ステータス/全レスポンス）", "type": "timeseries" } ], "preload": false, "refresh": "10s", "schemaVersion": 41, "tags": [ "metrics" ], "templating": { "list": [ { "current": { "text": "Prometheus", "value": "PBFA97CFB590B2093" }, "label": "Data Source", "name": "datasource", "options": [], "query": "prometheus", "refresh": 1, "regex": "", "type": "datasource" }, { "allValue": ".*", "current": { "text": "bookinfo", "value": "bookinfo" }, "datasource": "$datasource", "definition": "label_values(istio_requests_total{reporter=~\"source|waypoint\"},source_workload_namespace)", "includeAll": false, "label": "Source Namespace", "name": "Namespace", "options": [], "query": { "qryType": 1, "query": "label_values(istio_requests_total{reporter=~\"source|waypoint\"},source_workload_namespace)", "refId": "PrometheusVariableQueryEditor-VariableQuery" }, "refresh": 1, "type": "query" }, { "allValue": ".*", "current": { "text": "productpage-v1", "value": "productpage-v1" }, "datasource": "$datasource", "definition": "label_values(istio_requests_total{reporter=~\"source|waypoint\", source_workload_namespace=~\"$Namespace\"},source_workload)", "includeAll": false, "label": "Source Workload", "name": "Source", "options": [], "query": { "qryType": 1, "query": "label_values(istio_requests_total{reporter=~\"source|waypoint\", source_workload_namespace=~\"$Namespace\"},source_workload)", "refId": "PrometheusVariableQueryEditor-VariableQuery" }, "refresh": 1, "regex": "", "type": "query" }, { "allValue": ".*", "current": { "text": "details-v2", "value": "details-v2" }, "datasource": "$datasource", "definition": "label_values(istio_requests_total{reporter=~\"source|waypoint\", source_workload_namespace=~\"$Namespace\", source_workload=~\"$Source\"},destination_workload)", "includeAll": false, "label": "Destination Workload", "name": "Destination", "options": [], "query": { "qryType": 1, "query": "label_values(istio_requests_total{reporter=~\"source|waypoint\", source_workload_namespace=~\"$Namespace\", source_workload=~\"$Source\"},destination_workload)", "refId": "PrometheusVariableQueryEditor-VariableQuery" }, "refresh": 1, "regex": "", "type": "query" } ] }, "time": { "from": "now-24h", "to": "now" }, "timepicker": {}, "timezone": "browser", "title": "IstioによるHTTPプロトコル", "uid": "deg6mfd9jskxsd", "version": 1 }'
    istio-service-mesh-common-tcp:
      json: '{ "annotations": { "list": [ { "builtIn": 1, "datasource": { "type": "grafana", "uid": "-- Grafana --" }, "enable": true, "hide": true, "iconColor": "rgba(0, 211, 255, 1)", "name": "Annotations & Alerts", "type": "dashboard" } ] }, "description": "IstioによるTCP接続を可視化する", "editable": true, "fiscalYearStartMonth": 0, "graphTooltip": 1, "id": 2, "links": [], "panels": [ { "datasource": { "type": "datasource", "uid": "$datasource" }, "fieldConfig": { "defaults": { "color": { "fixedColor": "blue", "mode": "fixed" }, "custom": { "axisBorderShow": false, "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "barWidthFactor": 0.6, "drawStyle": "line", "fillOpacity": 0, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "insertNulls": false, "lineInterpolation": "linear", "lineWidth": 1, "pointSize": 4, "scaleDistribution": { "type": "linear" }, "showPoints": "always", "spanNulls": true, "stacking": { "group": "A", "mode": "none" }, "thresholdsStyle": { "mode": "off" } }, "mappings": [], "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": 0 } ] }, "unit": "reqpm" }, "overrides": [] }, "gridPos": { "h": 8, "w": 24, "x": 0, "y": 0 }, "id": 10, "interval": "5s", "options": { "legend": { "calcs": [ "mean", "lastNotNull" ], "displayMode": "table", "placement": "right", "showLegend": true }, "tooltip": { "hideZeros": false, "mode": "single", "sort": "none" } }, "pluginVersion": "12.1.1", "targets": [ { "datasource": { "type": "prometheus", "uid": "$datasource" }, "editorMode": "code", "expr": "sum(rate(istio_tcp_connections_opened_total{source_workload=~\"$Source\",destination_workload=~\"$Destination\",source_workload_namespace=~\"$Namespace\", reporter=~\"source|waypoint\", request_protocol=\"tcp\"}[5m])) by (source_workload, destination_workload) * 60", "legendFormat": "{{ source_workload }} ⇄ {{ destination_workload }}", "range": true, "refId": "A" } ], "title": "新しく確立されたTCP接続数", "type": "timeseries" }, { "datasource": { "type": "datasource", "uid": "$datasource" }, "fieldConfig": { "defaults": { "color": { "fixedColor": "blue", "mode": "fixed" }, "custom": { "axisBorderShow": false, "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "barWidthFactor": 0.6, "drawStyle": "line", "fillOpacity": 0, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "insertNulls": false, "lineInterpolation": "linear", "lineWidth": 1, "pointSize": 4, "scaleDistribution": { "type": "linear" }, "showPoints": "always", "spanNulls": true, "stacking": { "group": "A", "mode": "none" }, "thresholdsStyle": { "mode": "off" } }, "mappings": [], "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": 0 } ] }, "unit": "cpm" }, "overrides": [] }, "gridPos": { "h": 8, "w": 24, "x": 0, "y": 8 }, "id": 11, "interval": "5s", "options": { "legend": { "calcs": [ "mean", "lastNotNull" ], "displayMode": "table", "placement": "right", "showLegend": true, "sortBy": "Name", "sortDesc": true }, "tooltip": { "hideZeros": false, "mode": "single", "sort": "none" } }, "pluginVersion": "12.1.1", "targets": [ { "datasource": { "type": "prometheus", "uid": "$datasource" }, "editorMode": "code", "expr": "sort(sum(rate(istio_tcp_connections_opened_total{source_workload=~\"$Source\",destination_workload=~\"$Destination\",source_workload_namespace=~\"$Namespace\", reporter=~\"source|waypoint\", request_protocol=~\"tcp\"}[5m]) * 60 ) by (source_workload, destination_workload, response_flags))", "legendFormat": "{{ source_workload }} ⇄  {{ destination_workload }} | {{ response_flags }}", "range": true, "refId": "A" } ], "title": "各response_flagラベルで集計したTCP接続数", "type": "timeseries" } ], "preload": false, "refresh": "10s", "schemaVersion": 41, "tags": [ "metrics" ], "templating": { "list": [ { "current": { "text": "Prometheus", "value": "PBFA97CFB590B2093" }, "label": "Data Source", "name": "datasource", "options": [], "query": "prometheus", "refresh": 1, "regex": "", "type": "datasource" }, { "allValue": ".*", "current": { "text": "istio-egress", "value": "istio-egress" }, "datasource": "$datasource", "definition": "label_values(istio_tcp_connections_opened_total{reporter=~\"source|waypoint\"},source_workload_namespace)", "includeAll": false, "label": "Source Namespace", "name": "Namespace", "options": [], "query": { "qryType": 1, "query": "label_values(istio_tcp_connections_opened_total{reporter=~\"source|waypoint\"},source_workload_namespace)", "refId": "PrometheusVariableQueryEditor-VariableQuery" }, "refresh": 1, "type": "query" }, { "allValue": ".*", "current": { "text": "istio-egressgateway", "value": "istio-egressgateway" }, "datasource": "$datasource", "definition": "label_values(istio_tcp_connections_opened_total{reporter=~\"source|waypoint\", source_workload_namespace=~\"$Namespace\"},source_workload)", "includeAll": false, "label": "Source Workload", "name": "Source", "options": [], "query": { "qryType": 1, "query": "label_values(istio_tcp_connections_opened_total{reporter=~\"source|waypoint\", source_workload_namespace=~\"$Namespace\"},source_workload)", "refId": "PrometheusVariableQueryEditor-VariableQuery" }, "refresh": 1, "regex": "", "type": "query" }, { "allValue": ".*", "current": { "text": "unknown", "value": "unknown" }, "datasource": "$datasource", "definition": "label_values(istio_tcp_connections_opened_total{reporter=~\"source|waypoint\", source_workload_namespace=~\"$Namespace\", source_workload=~\"$Source\"},destination_workload)", "includeAll": false, "label": "Destination Workload", "name": "Destination", "options": [], "query": { "qryType": 1, "query": "label_values(istio_tcp_connections_opened_total{reporter=~\"source|waypoint\", source_workload_namespace=~\"$Namespace\", source_workload=~\"$Source\"},destination_workload)", "refId": "PrometheusVariableQueryEditor-VariableQuery" }, "refresh": 1, "regex": "", "type": "query" } ] }, "time": { "from": "now-24h", "to": "now" }, "timepicker": {}, "timezone": "", "title": "IstioによるTCP接続", "uid": "feg6z6pa4y9dsf", "version": 1 }'
    istio-service-mesh-traffic:
      json: '{ "annotations": { "list": [ { "builtIn": 1, "datasource": { "type": "grafana", "uid": "-- Grafana --" }, "enable": true, "hide": true, "iconColor": "rgba(0, 211, 255, 1)", "name": "Annotations & Alerts", "target": { "limit": 100, "matchAny": false, "tags": [], "type": "dashboard" }, "type": "dashboard" } ] }, "description": "Istioによるトラフィック管理を可視化する", "editable": true, "fiscalYearStartMonth": 0, "graphTooltip": 0, "id": 4, "links": [], "panels": [ { "collapsed": false, "gridPos": { "h": 1, "w": 24, "x": 0, "y": 0 }, "id": 31, "panels": [], "title": "ゾーンに基づく負荷分散", "type": "row" }, { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "fieldConfig": { "defaults": { "color": { "mode": "palette-classic" }, "custom": { "axisBorderShow": false, "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "barWidthFactor": 0.6, "drawStyle": "line", "fillOpacity": 0, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "insertNulls": false, "lineInterpolation": "linear", "lineWidth": 1, "pointSize": 3, "scaleDistribution": { "type": "linear" }, "showPoints": "always", "spanNulls": true, "stacking": { "group": "A", "mode": "none" }, "thresholdsStyle": { "mode": "off" } }, "mappings": [], "max": 100, "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": 0 } ] }, "unit": "percent" }, "overrides": [] }, "gridPos": { "h": 8, "w": 24, "x": 0, "y": 1 }, "id": 30, "options": { "legend": { "calcs": [ "mean", "lastNotNull" ], "displayMode": "table", "placement": "right", "showLegend": true, "sortBy": "Mean", "sortDesc": true }, "tooltip": { "hideZeros": false, "mode": "single", "sort": "none" } }, "pluginVersion": "12.1.1", "targets": [ { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "editorMode": "code", "expr": "sum(rate(envoy_cluster_lb_zone_routing_all_directly{pod=~\"^$Source.*$\", namespace=~\"$Namespace\", cluster_name=~\".*\\\\|$DestinationVersion\\\\|$DestinationApp.*\"}[5m])) by (pod, cluster_name) / sum(rate(envoy_cluster_lb_zone_routing_sampled{pod=~\"^$Source.*$\", namespace=~\"$Namespace\", cluster_name=~\".*\\\\|$DestinationVersion\\\\|$DestinationApp.*\"}[5m])) by (pod, cluster_name) ", "hide": false, "legendFormat": "{{ pod }} ⇄ {{ cluster_name }}", "range": true, "refId": "A" } ], "title": "同じゾーンへのL4/L7振り分け率", "type": "timeseries" }, { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "fieldConfig": { "defaults": { "color": { "mode": "palette-classic" }, "custom": { "axisBorderShow": false, "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "barWidthFactor": 0.6, "drawStyle": "line", "fillOpacity": 0, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "insertNulls": false, "lineInterpolation": "linear", "lineWidth": 1, "pointSize": 4, "scaleDistribution": { "type": "linear" }, "showPoints": "always", "spanNulls": true, "stacking": { "group": "A", "mode": "none" }, "thresholdsStyle": { "mode": "off" } }, "mappings": [], "max": 100, "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": 0 } ] }, "unit": "percent" }, "overrides": [] }, "gridPos": { "h": 8, "w": 24, "x": 0, "y": 9 }, "id": 32, "options": { "legend": { "calcs": [ "mean", "lastNotNull" ], "displayMode": "table", "placement": "right", "showLegend": true, "sortBy": "Mean", "sortDesc": true }, "tooltip": { "hideZeros": false, "mode": "single", "sort": "none" } }, "pluginVersion": "12.1.1", "targets": [ { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "editorMode": "code", "expr": "sum(rate(envoy_cluster_lb_zone_routing_cross_zone{pod=~\"^$Source.*$\", namespace=~\"$Namespace\", cluster_name=~\".*\\\\|$DestinationVersion\\\\|$DestinationApp.*\"}[5m])) by (pod, cluster_name) / sum(rate(envoy_cluster_lb_zone_routing_sampled{pod=~\"^$Source.*$\", namespace=~\"$Namespace\", cluster_name=~\".*\\\\|$DestinationVersion\\\\|$DestinationApp.*\"}[5m])) by (pod, cluster_name) ", "hide": false, "legendFormat": "{{ pod }} ⇄ {{ cluster_name }}", "range": true, "refId": "A" } ], "title": "異なるゾーンへのL4/L7振り分け率", "type": "timeseries" } ], "preload": false, "refresh": "5s", "schemaVersion": 41, "tags": [ "metrics" ], "templating": { "list": [ { "current": { "text": "Prometheus", "value": "PBFA97CFB590B2093" }, "label": "Data Source", "name": "datasource", "options": [], "query": "prometheus", "refresh": 1, "regex": "", "type": "datasource" }, { "current": { "text": "bookinfo", "value": "bookinfo" }, "datasource": { "type": "prometheus", "uid": "${datasource}" }, "definition": "label_values(istio_requests_total{reporter=~\"destination\"},source_workload_namespace)", "label": "Source Namespace", "name": "Namespace", "options": [], "query": { "qryType": 1, "query": "label_values(istio_requests_total{reporter=~\"destination\"},source_workload_namespace)", "refId": "PrometheusVariableQueryEditor-VariableQuery" }, "refresh": 1, "regex": "", "type": "query" }, { "current": { "text": "productpage-v1", "value": "productpage-v1" }, "datasource": { "type": "prometheus", "uid": "${datasource}" }, "definition": "label_values(istio_requests_total{reporter=~\"destination\", source_workload_namespace=~\"$Namespace\"},source_workload)", "label": "Source Workload", "name": "Source", "options": [], "query": { "qryType": 1, "query": "label_values(istio_requests_total{reporter=~\"destination\", source_workload_namespace=~\"$Namespace\"},source_workload)", "refId": "PrometheusVariableQueryEditor-VariableQuery" }, "refresh": 1, "regex": "", "type": "query" }, { "current": { "text": "details-v2", "value": "details-v2" }, "definition": "label_values(istio_requests_total{reporter=~\"destination\", source_workload_namespace=~\"$Namespace\", source_workload=~\"$Source\"},destination_workload)", "label": "Destination Workload", "name": "Destination", "options": [], "query": { "qryType": 1, "query": "label_values(istio_requests_total{reporter=~\"destination\", source_workload_namespace=~\"$Namespace\", source_workload=~\"$Source\"},destination_workload)", "refId": "PrometheusVariableQueryEditor-VariableQuery" }, "refresh": 1, "regex": "", "type": "query" }, { "current": { "text": "v2", "value": "v2" }, "definition": "label_values(istio_requests_total{reporter=~\"destination\", source_workload_namespace=~\"$Namespace\", source_workload=~\"$Source\", destination_workload=\"$Destination\"},destination_version)", "hide": 2, "label": "Destination Version", "name": "DestinationVersion", "options": [], "query": { "qryType": 1, "query": "label_values(istio_requests_total{reporter=~\"destination\", source_workload_namespace=~\"$Namespace\", source_workload=~\"$Source\", destination_workload=\"$Destination\"},destination_version)", "refId": "PrometheusVariableQueryEditor-VariableQuery" }, "refresh": 1, "regex": "", "type": "query" }, { "current": { "text": "details", "value": "details" }, "definition": "label_values(istio_requests_total{reporter=~\"destination\", source_workload_namespace=~\"$Namespace\", source_workload=~\"$Source\", destination_workload=\"$Destination\"},destination_app)", "hide": 2, "label": "Destination App", "name": "DestinationApp", "options": [], "query": { "qryType": 1, "query": "label_values(istio_requests_total{reporter=~\"destination\", source_workload_namespace=~\"$Namespace\", source_workload=~\"$Source\", destination_workload=\"$Destination\"},destination_app)", "refId": "PrometheusVariableQueryEditor-VariableQuery" }, "refresh": 1, "regex": "", "type": "query" } ] }, "time": { "from": "now-15m", "to": "now" }, "timepicker": {}, "timezone": "", "title": "Istioによるトラフィック管理", "uid": "ceg4ins3oledc2", "version": 1 }'
    istio-service-mesh-resiliency:
      json: '{ "annotations": { "list": [ { "builtIn": 1, "datasource": { "type": "grafana", "uid": "-- Grafana --" }, "enable": true, "hide": true, "iconColor": "rgba(0, 211, 255, 1)", "name": "Annotations & Alerts", "target": { "limit": 100, "matchAny": false, "tags": [], "type": "dashboard" }, "type": "dashboard" } ] }, "description": "Istioによる信頼性管理を可視化する", "editable": true, "fiscalYearStartMonth": 0, "graphTooltip": 0, "id": 3, "links": [], "panels": [ { "collapsed": false, "gridPos": { "h": 1, "w": 24, "x": 0, "y": 0 }, "id": 31, "panels": [], "title": "通信元ワークロードから見た宛先の正常性", "type": "row" }, { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "fieldConfig": { "defaults": { "color": { "mode": "palette-classic" }, "custom": { "axisBorderShow": false, "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "barWidthFactor": 0.6, "drawStyle": "line", "fillOpacity": 0, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "insertNulls": false, "lineInterpolation": "linear", "lineWidth": 1, "pointSize": 4, "scaleDistribution": { "type": "linear" }, "showPoints": "always", "spanNulls": true, "stacking": { "group": "A", "mode": "none" }, "thresholdsStyle": { "mode": "off" } }, "mappings": [], "max": 100, "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": 0 } ] }, "unit": "percent" }, "overrides": [] }, "gridPos": { "h": 8, "w": 24, "x": 0, "y": 1 }, "id": 30, "options": { "legend": { "calcs": [ "mean", "lastNotNull" ], "displayMode": "table", "placement": "right", "showLegend": true, "sortBy": "Mean", "sortDesc": true }, "tooltip": { "hideZeros": false, "mode": "single", "sort": "none" } }, "pluginVersion": "12.1.1", "targets": [ { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "editorMode": "code", "expr": "sum(envoy_cluster_membership_healthy{pod=~\"^$Source.*$\",namespace=~\"$Namespace\", cluster_name=~\".*\\\\|$DestinationVersion\\\\|$DestinationApp.*\"}) by (pod,cluster_name)  / sum(envoy_cluster_membership_total{pod=~\"^$Source.*$\",namespace=~\"$Namespace\", cluster_name=~\".*\\\\|$DestinationVersion\\\\|$DestinationApp.*\"}) by (pod,cluster_name)  * 100", "hide": false, "legendFormat": "{{ pod }} ⇄ {{ cluster_name }}", "range": true, "refId": "A" } ], "title": "宛先envoyクラスターの正常率（正常数/全メンバー数）", "type": "timeseries" }, { "collapsed": false, "gridPos": { "h": 1, "w": 24, "x": 0, "y": 9 }, "id": 28, "panels": [], "title": "宛先ワークロードに対するリトライ", "type": "row" }, { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "fieldConfig": { "defaults": { "color": { "mode": "palette-classic" }, "custom": { "axisBorderShow": false, "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "barWidthFactor": 0.6, "drawStyle": "line", "fillOpacity": 0, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "insertNulls": false, "lineInterpolation": "linear", "lineWidth": 1, "pointSize": 4, "scaleDistribution": { "type": "linear" }, "showPoints": "always", "spanNulls": true, "stacking": { "group": "A", "mode": "none" }, "thresholdsStyle": { "mode": "off" } }, "mappings": [], "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": 0 }, { "color": "red", "value": 80 } ] }, "unit": "cpm" }, "overrides": [] }, "gridPos": { "h": 8, "w": 24, "x": 0, "y": 10 }, "id": 22, "options": { "legend": { "calcs": [ "mean", "lastNotNull" ], "displayMode": "table", "placement": "right", "showLegend": true, "sortBy": "Mean", "sortDesc": true }, "tooltip": { "hideZeros": false, "mode": "single", "sort": "none" } }, "pluginVersion": "12.1.1", "targets": [ { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "disableTextWrap": false, "editorMode": "code", "expr": "sum(rate(envoy_cluster_upstream_rq_retry{pod=~\"^$Source.*$\",namespace=~\"$Namespace\", cluster_name=~\".*\\\\|$DestinationVersion\\\\|$DestinationApp.*\"}[5m])) by (pod,cluster_name) * 60", "fullMetaSearch": false, "hide": false, "includeNullMetadata": true, "legendFormat": "{{ pod }} ⇄ {{ cluster_name }}", "range": true, "refId": "A", "useBackend": false } ], "title": "リトライの実行数", "type": "timeseries" }, { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "fieldConfig": { "defaults": { "color": { "mode": "palette-classic" }, "custom": { "axisBorderShow": false, "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "barWidthFactor": 0.6, "drawStyle": "line", "fillOpacity": 0, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "insertNulls": false, "lineInterpolation": "linear", "lineWidth": 1, "pointSize": 4, "scaleDistribution": { "type": "linear" }, "showPoints": "always", "spanNulls": true, "stacking": { "group": "A", "mode": "none" }, "thresholdsStyle": { "mode": "off" } }, "mappings": [], "max": 100, "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": 0 }, { "color": "red", "value": 80 } ] }, "unit": "percent" }, "overrides": [] }, "gridPos": { "h": 8, "w": 24, "x": 0, "y": 18 }, "id": 23, "options": { "legend": { "calcs": [ "mean", "lastNotNull" ], "displayMode": "table", "placement": "right", "showLegend": true, "sortBy": "Mean", "sortDesc": true }, "tooltip": { "hideZeros": false, "mode": "single", "sort": "none" } }, "pluginVersion": "12.1.1", "targets": [ { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "editorMode": "code", "expr": "sum(envoy_cluster_upstream_rq_retry_success{pod=~\"^$Source.*$\",namespace=~\"$Namespace\", cluster_name=~\".*\\\\|$DestinationVersion\\\\|$DestinationApp.*\"}) by (pod,cluster_name) / sum(envoy_cluster_upstream_rq_retry{pod=~\"^$Source.*$\",namespace=~\"$Namespace\", cluster_name=~\".*\\\\|$DestinationVersion\\\\|$DestinationApp.*\"}) by (pod,cluster_name) * 100", "hide": false, "legendFormat": "{{ pod }} ⇄ {{ cluster_name }}", "range": true, "refId": "B" } ], "title": "リトライの成功率（成功数/全リトライ数）", "type": "timeseries" }, { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "fieldConfig": { "defaults": { "color": { "mode": "palette-classic" }, "custom": { "axisBorderShow": false, "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "barWidthFactor": 0.6, "drawStyle": "line", "fillOpacity": 0, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "insertNulls": false, "lineInterpolation": "linear", "lineWidth": 1, "pointSize": 4, "scaleDistribution": { "type": "linear" }, "showPoints": "always", "spanNulls": true, "stacking": { "group": "A", "mode": "none" }, "thresholdsStyle": { "mode": "off" } }, "mappings": [], "max": 100, "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": 0 }, { "color": "red", "value": 80 } ] }, "unit": "percent" }, "overrides": [] }, "gridPos": { "h": 8, "w": 24, "x": 0, "y": 26 }, "id": 32, "options": { "legend": { "calcs": [ "mean", "lastNotNull" ], "displayMode": "table", "placement": "right", "showLegend": true, "sortBy": "Mean", "sortDesc": true }, "tooltip": { "hideZeros": false, "mode": "single", "sort": "none" } }, "pluginVersion": "12.1.1", "targets": [ { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "editorMode": "code", "expr": "(sum(rate(envoy_cluster_upstream_rq_retry_limit_exceeded{pod=~\"^$Source.*$\",namespace=~\"$Namespace\",cluster_name=~\".*\\\\|$DestinationVersion\\\\|$DestinationApp.*\"}[5m])) by (pod,cluster_name)) / (sum(rate(envoy_cluster_upstream_rq_total{pod=~\"^$Source.*$\",namespace=~\"$Namespace\",cluster_name=~\".*\\\\|$DestinationVersion\\\\|$DestinationApp.*\"}[5m])) by (pod,cluster_name)) * 100", "hide": false, "legendFormat": "{{ pod }} ⇄ {{ cluster_name }}", "range": true, "refId": "B" } ], "title": "全リトライに失敗したリクエスト率（全失敗数/全リクエスト数）", "type": "timeseries" }, { "collapsed": false, "gridPos": { "h": 1, "w": 24, "x": 0, "y": 34 }, "id": 29, "panels": [], "title": "宛先ワークロードに対するタイムアウト", "type": "row" }, { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "fieldConfig": { "defaults": { "color": { "mode": "palette-classic" }, "custom": { "axisBorderShow": false, "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "barWidthFactor": 0.6, "drawStyle": "line", "fillOpacity": 0, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "insertNulls": false, "lineInterpolation": "linear", "lineWidth": 1, "pointSize": 4, "scaleDistribution": { "type": "linear" }, "showPoints": "always", "spanNulls": true, "stacking": { "group": "A", "mode": "none" }, "thresholdsStyle": { "mode": "off" } }, "mappings": [], "max": 100, "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": 0 }, { "color": "red", "value": 80 } ] }, "unit": "percent" }, "overrides": [] }, "gridPos": { "h": 8, "w": 24, "x": 0, "y": 35 }, "id": 25, "options": { "legend": { "calcs": [ "mean", "lastNotNull" ], "displayMode": "table", "placement": "right", "showLegend": true, "sortBy": "Mean", "sortDesc": true }, "tooltip": { "hideZeros": false, "mode": "single", "sort": "none" } }, "pluginVersion": "12.1.1", "targets": [ { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "editorMode": "code", "expr": "(sum(rate(envoy_cluster_upstream_rq_timeout{pod=~\"^$Source.*$\",namespace=~\"$Namespace\",cluster_name=~\".*\\\\|$DestinationVersion\\\\|$DestinationApp.*\"}[5m])) by (pod,cluster_name)) / (sum(rate(envoy_cluster_upstream_rq_total{pod=~\"^$Source.*$\",namespace=~\"$Namespace\",cluster_name=~\".*\\\\|$DestinationVersion\\\\|$DestinationApp.*\"}[5m])) by (pod,cluster_name)) * 100", "hide": false, "legendFormat": "{{ pod }} ⇄ {{ cluster_name }}", "range": true, "refId": "D" } ], "title": "通信処理タイムアウトになったリクエスト率（全タイムアウト数/全リクエスト数）", "type": "timeseries" }, { "collapsed": false, "gridPos": { "h": 1, "w": 24, "x": 0, "y": 43 }, "id": 33, "panels": [], "title": "接続プールに基づくサーキットブレイカー", "type": "row" }, { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "fieldConfig": { "defaults": { "color": { "mode": "palette-classic" }, "custom": { "axisBorderShow": false, "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "barWidthFactor": 0.6, "drawStyle": "line", "fillOpacity": 0, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "insertNulls": false, "lineInterpolation": "linear", "lineWidth": 1, "pointSize": 4, "scaleDistribution": { "type": "linear" }, "showPoints": "always", "spanNulls": true, "stacking": { "group": "A", "mode": "none" }, "thresholdsStyle": { "mode": "off" } }, "mappings": [], "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": 0 }, { "color": "red", "value": 80 } ] }, "unit": "cpm" }, "overrides": [] }, "gridPos": { "h": 8, "w": 24, "x": 0, "y": 44 }, "id": 34, "options": { "legend": { "calcs": [ "mean", "lastNotNull" ], "displayMode": "table", "placement": "right", "showLegend": true, "sortBy": "Mean", "sortDesc": true }, "tooltip": { "hideZeros": false, "mode": "single", "sort": "none" } }, "pluginVersion": "12.1.1", "targets": [ { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "editorMode": "code", "expr": "sum(rate(envoy_cluster_upstream_rq_pending_total{pod=~\"^$Source.*$\",namespace=~\"$Namespace\", cluster_name=~\".*\\\\|$DestinationVersion\\\\|$DestinationApp.*\"}[5m])) by (pod,cluster_name) * 60", "hide": false, "legendFormat": "{{ pod }} ⇄ {{ cluster_name }}", "range": true, "refId": "C" } ], "title": "接続プールからの接続取得を待機しているキュー内のリクエスト数", "type": "timeseries" }, { "collapsed": false, "gridPos": { "h": 1, "w": 24, "x": 0, "y": 52 }, "id": 27, "panels": [], "title": "外れ値検出に基づくサーキットブレイカー", "type": "row" }, { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "fieldConfig": { "defaults": { "color": { "mode": "palette-classic" }, "custom": { "axisBorderShow": false, "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "barWidthFactor": 0.6, "drawStyle": "line", "fillOpacity": 0, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "insertNulls": false, "lineInterpolation": "linear", "lineWidth": 1, "pointSize": 4, "scaleDistribution": { "type": "linear" }, "showPoints": "always", "spanNulls": true, "stacking": { "group": "A", "mode": "none" }, "thresholdsStyle": { "mode": "off" } }, "mappings": [], "max": 100, "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": 0 }, { "color": "red", "value": 80 } ] }, "unit": "percent" }, "overrides": [] }, "gridPos": { "h": 8, "w": 24, "x": 0, "y": 53 }, "id": 24, "options": { "legend": { "calcs": [ "mean", "lastNotNull" ], "displayMode": "table", "placement": "right", "showLegend": true, "sortBy": "Mean", "sortDesc": true }, "tooltip": { "hideZeros": false, "mode": "single", "sort": "none" } }, "pluginVersion": "12.1.1", "targets": [ { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "editorMode": "code", "expr": "(sum(envoy_cluster_outlier_detection_ejections_active{pod=~\"^$Source.*$\",namespace=~\"$Namespace\",cluster_name=~\".*\\\\|$DestinationVersion\\\\|$DestinationApp.*\"}) by (pod,cluster_name)) / (sum(envoy_cluster_membership_total{pod=~\"^$Source.*$\",namespace=~\"$Namespace\",cluster_name=~\".*\\\\|$DestinationVersion\\\\|$DestinationApp.*\"}) by (pod,cluster_name)) * 100", "hide": false, "legendFormat": "{{ pod }} ⇄ {{ cluster_name }}", "range": true, "refId": "C" } ], "title": "現在排除中の宛先メンバー率（排除数/全メンバー数）", "type": "timeseries" }, { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "fieldConfig": { "defaults": { "color": { "mode": "palette-classic" }, "custom": { "axisBorderShow": false, "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "barWidthFactor": 0.6, "drawStyle": "line", "fillOpacity": 0, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "insertNulls": false, "lineInterpolation": "linear", "lineWidth": 1, "pointSize": 4, "scaleDistribution": { "type": "linear" }, "showPoints": "always", "spanNulls": true, "stacking": { "group": "A", "mode": "none" }, "thresholdsStyle": { "mode": "off" } }, "mappings": [], "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": 0 }, { "color": "red", "value": 80 } ] }, "unit": "none" }, "overrides": [] }, "gridPos": { "h": 8, "w": 24, "x": 0, "y": 61 }, "id": 26, "options": { "legend": { "calcs": [ "mean", "lastNotNull" ], "displayMode": "table", "placement": "right", "showLegend": true, "sortBy": "Mean", "sortDesc": true }, "tooltip": { "hideZeros": false, "mode": "single", "sort": "none" } }, "pluginVersion": "12.1.1", "targets": [ { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "editorMode": "code", "expr": "envoy_cluster_outlier_detection_ejections_detected_consecutive_5xx{pod=~\"^$Source.*$\",namespace=~\"$Namespace\", cluster_name=~\".*\\\\|$DestinationVersion\\\\|$DestinationApp.*\"}", "hide": false, "legendFormat": "{{ pod }} ⇄ {{ cluster_name }}", "range": true, "refId": "C" } ], "title": "5xxレスポンスの連続検知数", "type": "timeseries" } ], "preload": false, "refresh": "5s", "schemaVersion": 41, "tags": [ "metrics" ], "templating": { "list": [ { "current": { "text": "Prometheus", "value": "PBFA97CFB590B2093" }, "label": "Data Source", "name": "datasource", "options": [], "query": "prometheus", "refresh": 1, "regex": "", "type": "datasource" }, { "current": {}, "datasource": { "type": "prometheus", "uid": "${datasource}" }, "definition": "label_values(istio_requests_total{reporter=~\"destination\"},source_workload_namespace)", "label": "Source Namespace", "name": "Namespace", "options": [], "query": { "qryType": 1, "query": "label_values(istio_requests_total{reporter=~\"destination\"},source_workload_namespace)", "refId": "PrometheusVariableQueryEditor-VariableQuery" }, "refresh": 1, "regex": "", "type": "query" }, { "current": {}, "datasource": { "type": "prometheus", "uid": "${datasource}" }, "definition": "label_values(istio_requests_total{reporter=~\"destination\", source_workload_namespace=~\"$Namespace\"},source_workload)", "label": "Source Workload", "name": "Source", "options": [], "query": { "qryType": 1, "query": "label_values(istio_requests_total{reporter=~\"destination\", source_workload_namespace=~\"$Namespace\"},source_workload)", "refId": "PrometheusVariableQueryEditor-VariableQuery" }, "refresh": 1, "regex": "", "type": "query" }, { "current": { "text": "xds-grpc", "value": "xds-grpc" }, "definition": "label_values(istio_requests_total{reporter=~\"destination\", source_workload_namespace=~\"$Namespace\", source_workload=~\"$Source\"},destination_workload)", "label": "Destination Workload", "name": "Destination", "options": [], "query": { "qryType": 1, "query": "label_values(istio_requests_total{reporter=~\"destination\", source_workload_namespace=~\"$Namespace\", source_workload=~\"$Source\"},destination_workload)", "refId": "PrometheusVariableQueryEditor-VariableQuery" }, "refresh": 1, "regex": "", "type": "query" }, { "current": { "text": "v-delayed-50percent-delayof7s", "value": "v-delayed-50percent-delayof7s" }, "definition": "label_values(istio_requests_total{reporter=~\"destination\", source_workload_namespace=~\"$Namespace\", source_workload=~\"$Source\", destination_workload=\"$Destination\"},destination_version)", "hide": 2, "label": "Destination Version", "name": "DestinationVersion", "options": [], "query": { "qryType": 1, "query": "label_values(istio_requests_total{reporter=~\"destination\", source_workload_namespace=~\"$Namespace\", source_workload=~\"$Source\", destination_workload=\"$Destination\"},destination_version)", "refId": "PrometheusVariableQueryEditor-VariableQuery" }, "refresh": 1, "regex": "", "type": "query" }, { "current": { "text": "details", "value": "details" }, "definition": "label_values(istio_requests_total{reporter=~\"destination\", source_workload_namespace=~\"$Namespace\", source_workload=~\"$Source\", destination_workload=\"$Destination\"},destination_app)", "hide": 2, "label": "Destination App", "name": "DestinationApp", "options": [], "query": { "qryType": 1, "query": "label_values(istio_requests_total{reporter=~\"destination\", source_workload_namespace=~\"$Namespace\", source_workload=~\"$Source\", destination_workload=\"$Destination\"},destination_app)", "refId": "PrometheusVariableQueryEditor-VariableQuery" }, "refresh": 1, "regex": "", "type": "query" } ] }, "time": { "from": "now-15m", "to": "now" }, "timepicker": {}, "timezone": "", "title": "Istioによる信頼性管理", "uid": "ceg4ins3oledcc", "version": 1 }'
    istio-service-mesh-encryption:
      json: '{ "annotations": { "list": [ { "builtIn": 1, "datasource": { "type": "grafana", "uid": "-- Grafana --" }, "enable": true, "hide": true, "iconColor": "rgba(0, 211, 255, 1)", "name": "Annotations & Alerts", "target": { "limit": 100, "matchAny": false, "tags": [], "type": "dashboard" }, "type": "dashboard" } ] }, "description": "Istioによるパケット暗号化を可視化する", "editable": true, "fiscalYearStartMonth": 0, "graphTooltip": 0, "id": 8, "links": [], "panels": [ { "collapsed": false, "gridPos": { "h": 1, "w": 24, "x": 0, "y": 0 }, "id": 28, "panels": [], "title": "TLS通信", "type": "row" }, { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "fieldConfig": { "defaults": { "color": { "mode": "palette-classic" }, "custom": { "axisBorderShow": false, "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "barWidthFactor": 0.6, "drawStyle": "line", "fillOpacity": 0, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "insertNulls": false, "lineInterpolation": "linear", "lineWidth": 1, "pointSize": 4, "scaleDistribution": { "type": "linear" }, "showPoints": "always", "spanNulls": true, "stacking": { "group": "A", "mode": "none" }, "thresholdsStyle": { "mode": "off" } }, "mappings": [], "max": 100, "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": 0 } ] }, "unit": "cpm" }, "overrides": [] }, "gridPos": { "h": 8, "w": 24, "x": 0, "y": 1 }, "id": 30, "options": { "legend": { "calcs": [ "mean", "lastNotNull" ], "displayMode": "table", "placement": "right", "showLegend": true, "sortBy": "Mean", "sortDesc": true }, "tooltip": { "hideZeros": false, "mode": "single", "sort": "none" } }, "pluginVersion": "12.1.1", "targets": [ { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "editorMode": "code", "expr": "sum(rate(envoy_cluster_ssl_connection_error{pod=~\"^$Source.*$\",namespace=~\"$Namespace\", cluster_name=~\".*\\\\|$DestinationVersion\\\\|$DestinationApp.*\"}[5m])) by (pod,cluster_name) * 60", "hide": false, "legendFormat": "{{ pod }} ⇄ {{ cluster_name }}", "range": true, "refId": "A" } ], "title": "TLSハンドシェイクの失敗数", "type": "timeseries" }, { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "fieldConfig": { "defaults": { "color": { "mode": "palette-classic" }, "custom": { "axisBorderShow": false, "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "barWidthFactor": 0.6, "drawStyle": "line", "fillOpacity": 0, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "insertNulls": false, "lineInterpolation": "linear", "lineWidth": 1, "pointSize": 4, "scaleDistribution": { "type": "linear" }, "showPoints": "always", "spanNulls": true, "stacking": { "group": "A", "mode": "none" }, "thresholdsStyle": { "mode": "off" } }, "mappings": [], "max": 100, "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": 0 }, { "color": "red", "value": 80 } ] }, "unit": "cpm" }, "overrides": [] }, "gridPos": { "h": 8, "w": 24, "x": 0, "y": 9 }, "id": 31, "options": { "legend": { "calcs": [ "mean", "lastNotNull" ], "displayMode": "table", "placement": "right", "showLegend": true, "sortBy": "Mean", "sortDesc": true }, "tooltip": { "hideZeros": false, "mode": "single", "sort": "none" } }, "pluginVersion": "12.1.1", "targets": [ { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "editorMode": "code", "expr": "sum(rate(envoy_cluster_ssl_fail_verify_no_cert{pod=~\"^$Source.*$\",namespace=~\"$Namespace\", cluster_name=~\".*\\\\|$DestinationVersion\\\\|$DestinationApp.*\"}[5m])) by (pod,cluster_name) * 60", "hide": false, "legendFormat": "{{ pod }} ⇄ {{ cluster_name }}", "range": true, "refId": "A" } ], "title": "TLSハンドシェイク中の証明書署名検証の失敗数", "type": "timeseries" } ], "preload": false, "refresh": "5s", "schemaVersion": 41, "tags": [ "metrics" ], "templating": { "list": [ { "current": { "text": "Prometheus", "value": "PBFA97CFB590B2093" }, "label": "Data Source", "name": "datasource", "options": [], "query": "prometheus", "refresh": 1, "regex": "", "type": "datasource" }, { "current": { "text": "bookinfo", "value": "bookinfo" }, "datasource": { "type": "prometheus", "uid": "${datasource}" }, "definition": "label_values(istio_requests_total{reporter=~\"source|waypoint\"},source_workload_namespace)", "label": "Source Namespace", "name": "Namespace", "options": [], "query": { "qryType": 1, "query": "label_values(istio_requests_total{reporter=~\"source|waypoint\"},source_workload_namespace)", "refId": "PrometheusVariableQueryEditor-VariableQuery" }, "refresh": 1, "regex": "", "type": "query" }, { "current": { "text": "productpage-v1", "value": "productpage-v1" }, "datasource": { "type": "prometheus", "uid": "${datasource}" }, "definition": "label_values(istio_requests_total{reporter=~\"source|waypoint\", source_workload_namespace=~\"$Namespace\"},source_workload)", "label": "Source Workload", "name": "Source", "options": [], "query": { "qryType": 1, "query": "label_values(istio_requests_total{reporter=~\"source|waypoint\", source_workload_namespace=~\"$Namespace\"},source_workload)", "refId": "PrometheusVariableQueryEditor-VariableQuery" }, "refresh": 1, "regex": "", "type": "query" }, { "current": { "text": "details-v2", "value": "details-v2" }, "definition": "label_values(istio_requests_total{reporter=~\"source|waypoint\", source_workload_namespace=~\"$Namespace\", source_workload=~\"$Source\"},destination_workload)", "label": "Destination Workload", "name": "Destination", "options": [], "query": { "qryType": 1, "query": "label_values(istio_requests_total{reporter=~\"source|waypoint\", source_workload_namespace=~\"$Namespace\", source_workload=~\"$Source\"},destination_workload)", "refId": "PrometheusVariableQueryEditor-VariableQuery" }, "refresh": 1, "regex": "", "type": "query" }, { "current": { "text": "unknown", "value": "unknown" }, "definition": "label_values(istio_requests_total{reporter=~\"destination\", source_workload_namespace=~\"$Namespace\", source_workload=~\"$Source\", destination_workload=~\"$Destination\"},destination_version)", "hide": 2, "label": "Destination Version", "name": "DestinationVersion", "options": [], "query": { "qryType": 1, "query": "label_values(istio_requests_total{reporter=~\"destination\", source_workload_namespace=~\"$Namespace\", source_workload=~\"$Source\", destination_workload=~\"$Destination\"},destination_version)", "refId": "PrometheusVariableQueryEditor-VariableQuery" }, "refresh": 1, "regex": "", "type": "query" }, { "current": { "text": "details", "value": "details" }, "definition": "label_values(istio_requests_total{reporter=~\"destination\", source_workload_namespace=~\"$Namespace\", source_workload=~\"$Source\", destination_workload=~\"$Destination\"},destination_app)", "hide": 2, "label": "Destination App", "name": "DestinationApp", "options": [], "query": { "qryType": 1, "query": "label_values(istio_requests_total{reporter=~\"destination\", source_workload_namespace=~\"$Namespace\", source_workload=~\"$Source\", destination_workload=~\"$Destination\"},destination_app)", "refId": "PrometheusVariableQueryEditor-VariableQuery" }, "refresh": 1, "regex": "", "type": "query" } ] }, "time": { "from": "now-15m", "to": "now" }, "timepicker": {}, "timezone": "", "title": "Istioによるパケット暗号化", "uid": "feg6z6mlpvcw0b", "version": 1 }'
    microservices-logs:
      json: '{ "annotations": { "list": [ { "builtIn": 1, "datasource": { "type": "grafana", "uid": "-- Grafana --" }, "enable": true, "hide": true, "iconColor": "rgba(0, 211, 255, 1)", "name": "Annotations & Alerts", "type": "dashboard" } ] }, "description": "マイクロサービスに関連するログを可視化する", "editable": true, "fiscalYearStartMonth": 0, "graphTooltip": 0, "id": 4, "links": [], "panels": [ { "datasource": { "type": "loki", "uid": "P8E80F9AEF21F6940" }, "fieldConfig": { "defaults": { "color": { "mode": "palette-classic" }, "custom": { "axisBorderShow": false, "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "ログ数", "axisPlacement": "auto", "fillOpacity": 80, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "lineWidth": 1, "scaleDistribution": { "type": "linear" }, "thresholdsStyle": { "mode": "off" } }, "decimals": 0, "mappings": [], "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": 0 } ] } }, "overrides": [ { "matcher": { "id": "byName", "options": "info" }, "properties": [ { "id": "color", "value": { "fixedColor": "light-green", "mode": "fixed" } } ] }, { "matcher": { "id": "byName", "options": "warn" }, "properties": [ { "id": "color", "value": { "fixedColor": "light-orange", "mode": "fixed" } } ] }, { "matcher": { "id": "byName", "options": "error" }, "properties": [ { "id": "color", "value": { "fixedColor": "light-red", "mode": "fixed" } } ] }, { "matcher": { "id": "byName", "options": "unknown" }, "properties": [ { "id": "color", "value": { "mode": "fixed" } } ] } ] }, "gridPos": { "h": 7, "w": 24, "x": 0, "y": 0 }, "id": 2, "interval": "1s", "options": { "barRadius": 0, "barWidth": 0.3, "fullHighlight": false, "groupWidth": 0.8, "legend": { "calcs": [ "sum" ], "displayMode": "list", "placement": "bottom", "showLegend": true }, "orientation": "auto", "showValue": "auto", "stacking": "normal", "text": { "valueSize": 1 }, "tooltip": { "hideZeros": false, "mode": "single", "sort": "none" }, "xField": "Time", "xTickLabelRotation": 0, "xTickLabelSpacing": 100 }, "pluginVersion": "12.1.1", "targets": [ { "datasource": { "type": "loki", "uid": "P8E80F9AEF21F6940" }, "direction": "backward", "editorMode": "code", "expr": "sum by(detected_level) (count_over_time({namespace=~\"${Namespace:regex}\"}[$__interval]))", "legendFormat": "{{ detected_level }}", "queryType": "range", "refId": "A" } ], "title": "マイクロサービスに関するログ数の推移", "type": "barchart" }, { "datasource": { "type": "loki", "uid": "P8E80F9AEF21F6940" }, "description": "", "fieldConfig": { "defaults": { "color": { "mode": "thresholds" }, "custom": { "align": "left", "cellOptions": { "type": "auto" }, "filterable": true, "inspect": false }, "mappings": [ { "options": { "Not Found": { "index": 3, "text": "-" }, "error": { "color": "super-light-red", "index": 2 }, "info": { "color": "super-light-green", "index": 0 }, "warn": { "color": "super-light-orange", "index": 1 } }, "type": "value" } ], "noValue": "-", "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": 0 } ] } }, "overrides": [ { "matcher": { "id": "byName", "options": "timestamp" }, "properties": [ { "id": "custom.minWidth", "value": 300 } ] }, { "matcher": { "id": "byName", "options": "detected level" }, "properties": [ { "id": "custom.cellOptions", "value": { "applyToRow": false, "mode": "basic", "type": "color-background" } } ] }, { "matcher": { "id": "byName", "options": "trace correlation link" }, "properties": [ { "id": "custom.width" } ] } ] }, "gridPos": { "h": 21, "w": 24, "x": 0, "y": 7 }, "id": 1, "options": { "cellHeight": "sm", "footer": { "countRows": true, "enablePagination": false, "fields": "", "reducer": [], "show": false }, "showHeader": true, "sortBy": [] }, "pluginVersion": "12.1.1", "targets": [ { "datasource": { "type": "loki", "uid": "P8E80F9AEF21F6940" }, "direction": "backward", "editorMode": "code", "expr": "{namespace=~\"${Namespace:regex}\"}", "legendFormat": "", "queryType": "range", "refId": "A" } ], "title": "マイクロサービスに関するログの履歴", "transformations": [ { "id": "extractFields", "options": { "delimiter": ",", "format": "json", "jsonPaths": [ { "alias": "", "path": "detected_level" }, { "path": "app" }, { "path": "container" } ], "keepTime": false, "replace": false, "source": "labels" } }, { "id": "extractFields", "options": { "delimiter": ",", "format": "json", "jsonPaths": [ { "path": "direction" }, { "path": "timestamp" }, { "path": "message" } ], "source": "Line" } }, { "id": "filterFieldsByName", "options": { "include": { "names": [ "Line", "trace correlation link", "detected_level", "app", "container", "direction", "timestamp", "message" ] } } }, { "id": "organize", "options": { "excludeByName": {}, "includeByName": {}, "indexByName": { "Line": 7, "app": 2, "container": 3, "detected_level": 1, "direction": 4, "message": 5, "timestamp": 0, "trace correlation link": 6 }, "renameByName": { "Line": "overall", "detected_level": "detected level", "timestamp": "", "trace correlation link": "" } } }, { "id": "sortBy", "options": { "fields": {}, "sort": [ { "desc": true, "field": "timestamp" } ] } } ], "type": "table" } ], "preload": false, "schemaVersion": 41, "tags": [ "logs" ], "templating": { "list": [ { "allowCustomValue": true, "current": { "text": "Loki", "value": "P8E80F9AEF21F6940" }, "description": "", "label": "Data Source", "name": "datasource", "options": [], "query": "loki", "refresh": 1, "regex": "", "type": "datasource" }, { "allowCustomValue": false, "current": { "text": [ "All" ], "value": [ "$__all" ] }, "datasource": { "type": "loki", "uid": "P8E80F9AEF21F6940" }, "definition": "", "description": "", "includeAll": true, "label": "Source Namespace", "multi": true, "name": "Namespace", "options": [], "query": { "label": "namespace", "refId": "LokiVariableQueryEditor-VariableQuery", "stream": "{namespace=~\"bookinfo|istio-egress|istio-ingress|keycloak\"}", "type": 1 }, "refresh": 1, "regex": "", "sort": 1, "type": "query" } ] }, "time": { "from": "now-5m", "to": "now" }, "timepicker": {}, "timezone": "browser", "title": "マイクロサービス（ログ）", "uid": "80d8b2d5-66bf-4e53-b2c6-8c747ba75efb", "version": 1 }'
    microservices-traces:
      json: '{ "annotations": { "list": [ { "builtIn": 1, "datasource": { "type": "grafana", "uid": "-- Grafana --" }, "enable": true, "hide": true, "iconColor": "rgba(0, 211, 255, 1)", "name": "Annotations & Alerts", "type": "dashboard" } ] }, "editable": true, "fiscalYearStartMonth": 0, "graphTooltip": 0, "id": 9, "links": [], "panels": [ { "datasource": { "type": "tempo", "uid": "P214B5B846CF3925F" }, "fieldConfig": { "defaults": { "color": { "mode": "thresholds" }, "custom": { "align": "left", "cellOptions": { "type": "auto" }, "filterable": true, "inspect": false }, "fieldMinMax": false, "mappings": [ { "options": { "<root span not yet received>": { "index": 0, "text": "-" } }, "type": "value" } ], "max": -3, "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": 0 } ] } }, "overrides": [ { "matcher": { "id": "byName", "options": "start time" }, "properties": [ { "id": "custom.width", "value": 250 } ] }, { "matcher": { "id": "byName", "options": "service" }, "properties": [ { "id": "custom.width", "value": 300 } ] }, { "matcher": { "id": "byName", "options": "name" }, "properties": [] } ] }, "gridPos": { "h": 20, "w": 24, "x": 0, "y": 0 }, "id": 1, "options": { "cellHeight": "sm", "footer": { "countRows": false, "fields": "", "reducer": [ "sum" ], "show": false }, "showHeader": true }, "pluginVersion": "12.1.1", "targets": [ { "datasource": { "type": "tempo", "uid": "P214B5B846CF3925F" }, "filters": [ { "id": "470aa074", "isCustomValue": false, "operator": "=", "scope": "span", "value": [], "valueType": "string" }, { "id": "duration-type", "value": "span" } ], "limit": 20, "metricsQueryType": "range", "query": "{span.istio.namespace=~\"${Namespace:regex}\"}", "queryType": "traceql", "refId": "A", "spss": 3, "tableType": "traces" } ], "title": "マイクロサービスに関するトレースの履歴", "transformations": [ { "id": "filterFieldsByName", "options": { "include": { "names": [ "Trace ID", "Start time", "Service", "Duration", "Name" ] } } }, { "id": "organize", "options": { "excludeByName": { "Trace Service": false }, "includeByName": {}, "indexByName": { "Duration": 1, "Name": 4, "Service": 3, "Start time": 0, "Trace ID": 2 }, "orderByMode": "manual", "renameByName": { "Duration": "duration", "Name": "name", "Service": "service", "Span ID": "span id", "Start time": "start time", "Trace ID": "trace id", "Trace Name": "span name", "Trace Service": "service", "http.method": "", "http.url": "", "istio.canonical_service": "service", "istio.namespace": "namespace", "kind": "span kind", "nested": "span", "traceIdHidden": "" } } }, { "id": "sortBy", "options": { "fields": {}, "sort": [ { "desc": true, "field": "start time" } ] } } ], "type": "table" }, { "datasource": { "type": "tempo", "uid": "P214B5B846CF3925F" }, "fieldConfig": { "defaults": { "color": { "mode": "thresholds" }, "custom": { "align": "left", "cellOptions": { "type": "auto" }, "filterable": true, "inspect": false }, "fieldMinMax": false, "mappings": [ { "options": { "error": { "color": "#FF7383", "index": 2 }, "ok": { "color": "#808080", "index": 1 }, "unset": { "color": "super-light-green", "index": 0 } }, "type": "value" } ], "max": -3, "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": 0 } ] } }, "overrides": [ { "matcher": { "id": "byName", "options": "start time" }, "properties": [ { "id": "custom.width", "value": 250 } ] }, { "matcher": { "id": "byName", "options": "service" }, "properties": [ { "id": "custom.width", "value": 200 } ] }, { "matcher": { "id": "byName", "options": "status" }, "properties": [ { "id": "custom.cellOptions", "value": { "mode": "basic", "type": "color-background" } } ] }, { "matcher": { "id": "byName", "options": "request-id" }, "properties": [ { "id": "links", "value": [ { "targetBlank": true, "title": "span name", "url": "${Domain}/a/grafana-exploretraces-app/explore?from=now-5m&to=now&timezone=Asia%2FTokyo&var-ds=P214B5B846CF3925F&actionView=traceList&var-filters=span.guid:x-request-id%7C%3D%7C${__value.text}&var-primarySignal=true&var-metric=rate&var-groupBy=&var-spanListColumns=&var-latencyThreshold=&var-partialLatencyThreshold=\n" } ] } ] } ] }, "gridPos": { "h": 20, "w": 24, "x": 0, "y": 20 }, "id": 2, "options": { "cellHeight": "sm", "footer": { "countRows": false, "fields": "", "reducer": [ "sum" ], "show": false }, "showHeader": true }, "pluginVersion": "12.1.1", "targets": [ { "datasource": { "type": "tempo", "uid": "P214B5B846CF3925F" }, "filters": [ { "id": "470aa074", "isCustomValue": false, "operator": "=", "scope": "span", "value": [], "valueType": "string" }, { "id": "duration-type", "value": "span" } ], "limit": 20, "metricsQueryType": "range", "query": "{span.istio.namespace=~\"${Namespace:regex}\"} | select(span.guid:x-request-id, span.istio.namespace, span.istio.canonical_service, span.http.method, span.http.url.path, span:kind, span:status, span.system.name, span.system.environment)", "queryType": "traceql", "refId": "A", "spss": 3, "tableType": "spans" } ], "title": "マイクロサービスに関するスパンの履歴", "transformations": [ { "id": "filterFieldsByName", "options": { "include": { "names": [ "Start time", "http.method", "http.url.path", "istio.canonical_service", "istio.namespace", "kind", "status", "system.environment", "system.name", "Duration", "guid:x-request-id" ] } } }, { "id": "organize", "options": { "excludeByName": { "Trace Service": false }, "includeByName": {}, "indexByName": { "Duration": 1, "Start time": 0, "http.method": 5, "http.url.path": 6, "istio.canonical_service": 3, "istio.namespace": 2, "kind": 4, "status": 7, "system.environment": 9, "system.name": 8 }, "orderByMode": "manual", "renameByName": { "Duration": "duration", "Name": "span name", "Span ID": "span id", "Start time": "start time", "Trace ID": "trace id", "Trace Name": "span name", "Trace Service": "service", "guid:x-request-id": "request-id", "http.method": "", "http.url": "", "istio.canonical_service": "service", "istio.namespace": "namespace", "kind": "span kind", "nested": "span", "traceIdHidden": "" } } }, { "id": "sortBy", "options": { "fields": {}, "sort": [ { "desc": true, "field": "start time" } ] } } ], "type": "table" } ], "preload": false, "schemaVersion": 41, "tags": [ "traces" ], "templating": { "list": [ { "current": { "text": "Tempo", "value": "P214B5B846CF3925F" }, "label": "Data Source", "name": "datasource", "options": [], "query": "tempo", "refresh": 1, "regex": "", "type": "datasource" }, { "allowCustomValue": false, "current": { "text": "All", "value": [ "$__all" ] }, "datasource": { "type": "tempo", "uid": "P214B5B846CF3925F" }, "definition": "", "description": "", "includeAll": true, "label": "Source Namespace", "multi": true, "name": "Namespace", "options": [], "query": { "label": "istio.namespace", "refId": "TempoDatasourceVariableQueryEditor-VariableQuery", "type": 1 }, "refresh": 1, "regex": "", "sort": 1, "type": "query" }, { "current": { "text": "http://localhost:3000", "value": "http://localhost:3000" }, "description": "", "hide": 2, "label": "Grafana Domain", "name": "Domain", "options": [ { "selected": true, "text": "http://localhost:3000", "value": "http://localhost:3000" } ], "query": "http://localhost:3000", "type": "textbox" } ] }, "time": { "from": "now-5m", "to": "now" }, "timepicker": {}, "timezone": "", "title": "マイクロサービス（トレース）", "uid": "e79893dd-4f7d-4fc0-a6cf-ee6df61211f2", "version": 1 }'

dashboardProviders:
  dasboardproviders.yaml:
    apiVersion: 1
    providers:
      - name: local
        options:
          path: /var/lib/grafana/dashboards/local

resources:
  requests:
    cpu: 50m
    memory: 51Mi
  limits:
    cpu: 1000m
    memory: 1024Mi
